#!/bin/bash
# Dennis Kruemmel, 2018

path="/Library/Application Support/Scripts" # Edit me
[[ -d "${path}" ]] || mkdir -p "${path}"

identifier="com.mycompany" # Edit me

echo "
IyEvYmluL2Jhc2gKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBEZW5uaXMgS3J1ZW1tZWwsIDIwMTgKIwojIHdpdGggY29udGVudCBmcm9tCiMgICBodHRwczovL2dpdGh1Yi5jb20vaG9tZWJ5c2l4L2F1dG8tdXBkYXRlLW1hZ2ljCiMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIwojIFRoaXMgc2NyaXB0IGlzIGRlc2lnbmVkIHRvIGJlIGVtYmVkZGVkIGluIGEgaGVscGVyIHNjcmlwdCAibWFnaWNfaW5zdGFsbGVyX2NvbnRhaW5lci5zaCIuCiMgYmFzZTY0IC1pIC4vbWFnaWNfaW5zdGFsbGVyLnNoIHwgcGJjb3B5CiMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBOQU1FCiMgICBtYWdpY19pbnN0YWxsZXIuc2ggLS0gc2NyaXB0IGZvciBtYW5hZ2VkIGluc3RhbGxhdGlvbiB0aHJvdWdoIGphbWYgcHJvLgojIAojIFNZTk9QU0lTCiMgICAuL21hZ2ljX2luc3RhbGxlci5zaCA8bW91bnRQb2ludD4gPGNvbXB1dGVyTmFtZT4gPHVzZXJOYW1lPiAiPHByb2Nlc3NOYW1lPls7PHByb2Nlc3NOYW1lPjsuLi5dIiAiWzxhcHBWZXJzaW9uPl0iICJbPGRpc3BsYXluYW1lPl0iICI8cGtnVG9JbnN0YWxsPls7PHBrZ1RvSW5zdGFsbD47Li4uXSIgWzxkZWFkbGluZT5dIFs8aWNvbj5dIFthcHBWZXJzaW9uT2xkXQojIAojIERFU0NSSVBUSU9OCiMgICBtb3VudFBvaW50CiMgICAgICAgdGFyZ2V0IGZvciBpbnN0YWxsZXIKIyAgICAgICBXaWxsIGJlIGF1dG9tYXRpY2FsbHkgc2V0IGZyb20gamFtZiBwcm8KIyAgICAgICBFeGFtcGxlOgojICAgICAgICAgIi8iCiMgCiMgICBjb21wdXRlck5hbWUKIyAgICAgICBob3N0bmFtZSBmcm9tIHRoZSBkZXN0aW5hdGlvbiBjb21wdXRlcgojICAgICAgIFdpbGwgYmUgYXV0b21hdGljYWxseSBzZXQgZnJvbSBqYW1mIHBybwojICAgICAgIEV4YW1wbGU6CiMgICAgICAgICAiTUJQMjAxNy0wMDEiCiMKIyAgIHVzZXJOYW1lCiMgICAgICAgbG9nZ2VkIGluIHVzZXIKIyAgICAgICBXaWxsIGJlIGF1dG9tYXRpY2FsbHkgc2V0IGZyb20gamFtZiBwcm8KIyAgICAgICBFeGFtcGxlOgojICAgICAgICAgIkNsYXJhLktvcm4iCiMgCiMgICBwcm9jZXNzTmFtZQojICAgICAgIHByb2Nlc3MgdG8gd2F0Y2guIFVzZSA7IGFzIGRlbGltaXRlciBmb3IgbXVsdGlwbGUgcHJvY2VzcyBuYW1lcwojICAgICAgIEV4YW1wbGU6CiMgICAgICAgICAiZmlyZWZveCIKIyAgICAgICAgICJmaXJlZm94O3NhZmFyaSQiCiMKIyAgIGFwcFZlcnNpb24gKE9wdGlvbmFsKQojICAgICAgIFZlcnNpb24gTnVtYmVyIGZyb20gdGhlIGFwcCB3aGljaCB3aWxsIGJlIGluc3RhbGxlZC4KIyAgICAgICBFeGFtcGxlOgojICAgICAgICAgIjUyLjcuMyIKIwojICAgZGlzcGxheW5hbWUgKE9wdGlvbmFsKQojICAgICAgIE5hbWUgd2hpY2ggYmUgdXNlZCBmb3Igbm90aWZpY2F0aW9ucwojICAgICAgIEV4YW1wbGU6CiMgICAgICAgICAiRmlyZWZveCB3aXRoIENDSyIKIwojICAgcGtnVG9JbnN0YWxsCiMgICAgICAgUEtHcyBjYWNoZWQgaW4gdGhlIEpBTUYgIldhaXRpbmcgUm9vbSIuIFVzZSA7IGFzIGRlbGltaXRlciBmb3IgbXVsdGlwbGUgUGFja2FnZXMgdG8gaW5zdGFsbC4KIyAgICAgICBFeGFtcGxlOgojICAgICAgICAgIk15UGFja2FnZS0xLjAuMC5wa2ciCiMgICAgICAgICAiTXlQYWNrYWdlLTEuMC4wLnBrZztNeVBhY2thZ2VVcGRhdGUtMS4xLjAucGtnIgojIAojICAgZGVhZGxpbmUgKE9wdGlvbmFsKQojICAgICAgIGRhdGUgYXMgdW5peCB0aW1lc3RhbXAgb2YgdGhlIGZvcmNlZCBpbnN0YWxsLiBBZnRlciB0aGlzIGRhdGUgdGhlIGNvdW50ZG93biB3aWxsIGJlIGlnbm9yZWQuCiMgICAgICAgSWYgdGhlIGRlYWRsaW5lIGlzIHNldCwgdGhlIGZvcmNlZCBpbnN0YWxsIHdpbGwgYmUgYWN0aXZhdGVkLgojICAgICAgIGNhbGN1bGF0ZSB0aGUgZGVhZGxpbmU6CiMgICAgICAgZGF0ZSAtaiAtZiAiJWQuJW0uJVkgJUg6JU06JVMiICIzMS4xMi4yMDE4IDA2OjAwOjAwIiArJXMKIyAgICAgICBFeGFtcGxlOgojICAgICAgICAgIjE1NDYyMzI0MDAiCiMKIyAgIGljb24gKE9wdGlvbmFsKQojICAgICAgIFRoaXMgaWNvbiB3aWxsIGJlIHVzZWQgZm9yIHRoZSBtZXNzYWdlYm94CiMgICAgICAgRXhhbXBsZToKIyAgICAgICAgICIvQXBwbGljYXRpb25zL0ZpcmVmb3guYXBwL0NvbnRlbnRzL1Jlc291cmNlcy9maXJlZm94LmljbnMiCiMKIyAgIGFwcFZlcnNpb25PbGQgKE9wdGlvbmFsKQojICAgICAgIGNvbW1hbmQgdG8gZGV0ZXJtaW5lIHRoZSB2ZXJzaW9uIGZyb20gdGhlIG9sZCBpbnN0YWxsZWQgYXBwLgojICAgICAgIEV4YW1wbGU6CiMgICAgICAgICAiZGVmYXVsdHMgcmVhZCAvQXBwbGljYXRpb25zL0ZpcmVmb3guYXBwL0NvbnRlbnRzL0luZm8ucGxpc3QgQ0ZCdW5kbGVTaG9ydFZlcnNpb25TdHJpbmciCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpsb2dGaWxlPSIvdmFyL2xvZy9tYWdpY19pbnN0YWxsZXIubG9nIgpTY3JpcHRMb2coKSB7ICMgUmUtZGlyZWN0IGxvZ2dpbmcgdG8gdGhlIGxvZyBmaWxlIC4uLgoJaWYgW1sgISAteiAiJHtsb2dGaWxlfSIgXV0gJiYgW1sgISAtZiAiJHtsb2dGaWxlfSIgXV07IHRoZW4KCQkvdXNyL2Jpbi90b3VjaCAiJHtsb2dGaWxlfSIgfHwgZXhpdCAxCgllbGlmIFtbIC16ICIke2xvZ0ZpbGV9IiBdXTsgdGhlbgoJCWxvZ0ZpbGU9Ii92YXIvbG9nL3N5c3RlbS5sb2ciCgkJL3Vzci9iaW4vdG91Y2ggIiR7bG9nRmlsZX0iIHx8IGV4aXQgMQoJZmkKCiAgICBleGVjIDM+JjEgND4mMiAgICAgICAgICAjIFNhdmUgc3RhbmRhcmQgb3V0cHV0IGFuZCBzdGFuZGFyZCBlcnJvcgogICAgZXhlYyAxPj4iJHtsb2dGaWxlfSIgICAgIyBSZWRpcmVjdCBzdGFuZGFyZCBvdXRwdXQgdG8gbG9nRmlsZQogICAgZXhlYyAyPj4iJHtsb2dGaWxlfSIgICAgIyBSZWRpcmVjdCBzdGFuZGFyZCBlcnJvciB0byBsb2dGaWxlCgogICAgU2NyaXB0TG9nTk9XPSQoZGF0ZSArJVktJW0tJWRcICVIOiVNOiVTKQogICAgL2Jpbi9lY2hvICJbJHtkaXNwbGF5bmFtZX0gfCAke1NjcmlwdExvZ05PV31dICAkezF9IiA+PiAke2xvZ0ZpbGV9CglleGVjIDE+JjMgMj4mNAp9CgpKQU1GPSIvdXNyL2xvY2FsL2Jpbi9qYW1mIgpKQU1GX0hFTFBFUj0iL0xpYnJhcnkvQXBwbGljYXRpb24gU3VwcG9ydC9KQU1GL2Jpbi9qYW1mSGVscGVyLmFwcC9Db250ZW50cy9NYWNPUy9qYW1mSGVscGVyIgpKQU1GX0lDT05TPSIvTGlicmFyeS9BcHBsaWNhdGlvbiBTdXBwb3J0L0pBTUYvYmluL2phbWZIZWxwZXIuYXBwL0NvbnRlbnRzL1Jlc291cmNlcyIKTUFOQUdFTUVOVF9BQ1RJT049Ii9MaWJyYXJ5L0FwcGxpY2F0aW9uIFN1cHBvcnQvSkFNRi9iaW4vTWFuYWdlbWVudCBBY3Rpb24uYXBwL0NvbnRlbnRzL01hY09TL01hbmFnZW1lbnQgQWN0aW9uIgpKQU1GX0NBQ0hFPSIvTGlicmFyeS9BcHBsaWNhdGlvbiBTdXBwb3J0L0pBTUYvV2FpdGluZyBSb29tIgpjdXJyZW50dXNlcj0kKGxzIC1sIC9kZXYvY29uc29sZSB8IGN1dCAtZCAiICIgLWYgNCkKc2tpcHBpbmdfY291bnRlcl9kaXI9Ii9MaWJyYXJ5L0FwcGxpY2F0aW9uIFN1cHBvcnQvU2NyaXB0cy9tYWdpY19pbnN0YWxsZXIiICMgRWRpdCBtZQpbWyAtZCAiJHtza2lwcGluZ19jb3VudGVyX2Rpcn0iIF1dIHx8IG1rZGlyIC1wICIke3NraXBwaW5nX2NvdW50ZXJfZGlyfSIKd2FpdGluZ19kdXJhdGlvbj0oIDg2NDAwIDE0NDAwIDcyMDAgMTgwMCAzMDAgKSAjIDAgd2lsbCBkZWFjdGl2YXRlIHRoZSBjb3VudGRvd24Kbm93PSIkKGRhdGUgKyVzKSIKaWRlbnRpZmllcj0iY29tLm15Y29tcGFueSIgIyBFZGl0IG1lCgpkaXNwbGF5VXNlck1lc3NhZ2UgKCkgewoJTVlfTUVTU0FHRT0iJHsxfSIKCVtbIC16ICIkezJ9IiBdXSAmJiB0aW1lb3V0PSI3MjAwIiB8fCB0aW1lb3V0PSIkezJ9IgoJW1sgLXogIiR7M30iIF1dICYmIGNhbmNlbD0iZmFsc2UiIHx8IGNhbmNlbD0iJHszfSIKCWlmCiAgICAgICAgW1sgLW4gIiR7Y3VzdG9taWNvbn0iIF1dICYmCiAgICAgICAgW1sgLWYgIiR7Y3VzdG9taWNvbn0iIF1dOwogICAgICAgIHRoZW4KCQlpY29uPSIke2N1c3RvbWljb259IgoJZWxpZgogICAgICAgIFtbIC1mICIvU3lzdGVtL0xpYnJhcnkvQ29yZVNlcnZpY2VzL1NvZnR3YXJlIFVwZGF0ZS5hcHAvQ29udGVudHMvUmVzb3VyY2VzL1NvZnR3YXJlVXBkYXRlLmljbnMiIF1dOwogICAgICAgIHRoZW4KCQlpY29uPSIvU3lzdGVtL0xpYnJhcnkvQ29yZVNlcnZpY2VzL1NvZnR3YXJlIFVwZGF0ZS5hcHAvQ29udGVudHMvUmVzb3VyY2VzL1NvZnR3YXJlVXBkYXRlLmljbnMiCgllbHNlCgkJaWNvbj0iJHtKQU1GX0lDT05TfS9NZXNzYWdlLnBuZyIKCWZpCglpZiBbWyAiJHtjYW5jZWx9IiA9ICJmYWxzZSIgXV07IHRoZW4KCQkiJHtKQU1GX0hFTFBFUn0iIFwKCQkJLXdpbmRvd1R5cGUgdXRpbGl0eSBcCgkJCS10aXRsZSAiU3lzdGVtdXBkYXRlcyB2ZXJmw7xnYmFyIiBcCgkJCS1kZXNjcmlwdGlvbiAiJHtNWV9NRVNTQUdFfSIgXAoJCQktaWNvbiAiJHtpY29ufSIgXAoJCQktYnV0dG9uMSAiSW5zdGFsbGllcmVuIiBcCgkJCS1kZWZhdWx0QnV0dG9uIDEgXAoJCQktdGltZW91dCAke3RpbWVvdXR9IFwKCQkJLWNvdW50ZG93bgoJZWxzZQoJCSIke0pBTUZfSEVMUEVSfSIgXAoJCQktd2luZG93VHlwZSB1dGlsaXR5IFwKCQkJLXRpdGxlICJTeXN0ZW11cGRhdGVzIHZlcmbDvGdiYXIiIFwKCQkJLWRlc2NyaXB0aW9uICIke01ZX01FU1NBR0V9IiBcCgkJCS1pY29uICIke2ljb259IiBcCgkJCS1idXR0b24xICJJbnN0YWxsaWVyZW4iIFwKCQkJLWJ1dHRvbjIgIlNww6R0ZXIiIFwKCQkJLWRlZmF1bHRCdXR0b24gMSBcCgkJCS1jYW5jZWxCdXR0b24gMiBcCgkJCS10aW1lb3V0ICR7dGltZW91dH0gXAoJCQktY291bnRkb3duCgkgZmkKCn0KCmNvbXBhcmVWZXJzaW9uICgpewogICAgL3Vzci9iaW4vcHl0aG9uIC0gIiQxIiAiJDIiIDw8IEVPRgppbXBvcnQgc3lzCmZyb20gZGlzdHV0aWxzLnZlcnNpb24gaW1wb3J0IExvb3NlVmVyc2lvbiBhcyBMVgpwcmludCBMVihzeXMuYXJndlsxXSkgPj0gTFYoc3lzLmFyZ3ZbMl0pCkVPRgp9CgppZiBbIC1uICIkezR9IiBdOyB0aGVuCglhcHBuYW1lPSIkezR9IgplbHNlCgllY2hvICJFcnJvcjogUHJvY2Vzc25hbWUgbm90IHNldCAoaGludDogYXJndW1lbnQgIzQpIiAxPiYyCiAgICBlY2hvICJQcm9jZXNzbmFtZSAodXNlIDsgYXMgZGVsaW1pdGVyKSIKCWV4aXQgNApmaQoKaWYgWyAtbiAiJHs1fSIgXTsgdGhlbgoJYXBwVmVyc2lvbj0iJHs1fSIKZWxzZQoJYXBwVmVyc2lvbj0iIgpmaQoKaWYgWyAtbiAiJHs2fSIgXTsgdGhlbgoJZGlzcGxheW5hbWU9IiR7Nn0iCmVsc2UKCWVjaG8gIkluZm86IERpc3BsYXluYW1lIG5vdCBzZXQgKGhpbnQ6IGFyZ3VtZW50ICM2KS4gVXNpbmcgQXBwbmFtZSBcIiR7YXBwbmFtZX1cIiBhbmQgYXBwVmVyc2lvbiBcIiR7YXBwVmVyc2lvbn1cIiBhcyBkaXNwbGF5bmFtZS4iCglpZiBbWyAtbiAiJHthcHBWZXJzaW9ufSIgXV07IHRoZW4KICAgICAgICBkaXNwbGF5bmFtZT0iJHthcHBuYW1lfSAke2FwcFZlcnNpb259IgogICAgZWxzZQoJICAgIGRpc3BsYXluYW1lPSIke2FwcG5hbWV9IgogICAgZmkKICAgIGVjaG8gIkRpc3BsYXluYW1lOiBcIiR7ZGlzcGxheW5hbWV9XCIiCmZpCgppZiBbIC1uICIkezd9IiBdOyB0aGVuCglwa2dzPSIkezd9IgplbHNlCgllY2hvICJFcnJvcjogUEtHcyB0byBpbnN0YWxsIG5vdCBzZXQgKGhpbnQ6IGFyZ3VtZW50ICM3KSIgMT4mMgogICAgZWNobyAiUEtHcyB0byBpbnN0YWxsICh1c2UgOyBhcyBkZWxpbWl0ZXIpIgoJZXhpdCA3CmZpCgpza2lwcGluZ19jb3VudGVyPSIke3NraXBwaW5nX2NvdW50ZXJfZGlyfS8ke2Rpc3BsYXluYW1lfSIKdG91Y2ggIiR7c2tpcHBpbmdfY291bnRlcn0iCgppZiBbIC1uICIkezh9IiBdOyB0aGVuCglkZWFkbGluZT0iJHs4fSIKZWxzZQoJZGVhZGxpbmU9IjAiCmZpCltbICIke2RlYWRsaW5lfSIgPT0gIjAiIF1dICYmIGVjaG8gImRlYWRsaW5lOiBub3Qgc2V0IiB8fCBlY2hvICJkZWFkbGluZTogJChkYXRlIC1yICR7ZGVhZGxpbmV9ICsiJWQuJW0uJVkgJUg6JU06JVMiKSIKCmlmIFsgLW4gIiR7OX0iIF07IHRoZW4KCWN1c3RvbWljb249IiR7OX0iCmZpCgppZiBbIC1uICIkezEwfSIgXTsgdGhlbgogICAgaWYgW1sgLXogIiR7MTF9IiBdXTsgdGhlbgogICAgICAgIHBsaXN0S2V5PSJDRkJ1bmRsZVNob3J0VmVyc2lvblN0cmluZyIKICAgIGVsc2UKICAgICAgICBwbGlzdEtleT0iJHsxMX0iCiAgICBmaQoJYXBwVmVyc2lvbk9sZD0iJChkZWZhdWx0cyByZWFkICIkezEwfSIgIiR7cGxpc3RLZXl9IiAyPi9kZXYvbnVsbCkiCmZpCgpkZWNsYXJlIC1hIGFwcGFycmF5CmRlY2xhcmUgLWEgcGtnYXJyYXkKYXBwbGluZXM9JChlY2hvICIke2FwcG5hbWV9Inx0ciAiOyIgIlxuIikKd2hpbGUgcmVhZCAtciBhcHA7IGRvCglhcHBhcnJheSs9KCIkYXBwIikKZG9uZSA8PDwiJHthcHBsaW5lc30iCgpwa2dsaW5lcz0kKGVjaG8gIiR7cGtnc30ifHRyICI7IiAiXG4iKQp3aGlsZSByZWFkIC1yIHBrZzsgZG8KCXBrZ2FycmF5Kz0oIiRwa2ciKQpkb25lIDw8PCIke3BrZ2xpbmVzfSIKCiMgU2NyaXB0TG9nICJLaWxsaW5nIG9sZCBwcm9jZXNzZXMuIgojIFNjcmlwdExvZyAic2VsZnBpZDogJCQiCm90aGVycGlkcz0kKCBwcyBhdXggfCBncmVwICJbbV1hZ2ljX2luc3RhbGxlciIgfCBncmVwICIkKGVjaG8gJHthcHBuYW1lfXxzZWQgJ3MvOy9cXHwvZycpIiB8IGF3ayAne3ByaW50ICQyfScgfCBncmVwIC12ICIkJCIgKQojIFNjcmlwdExvZyAib3RoZXJwaWRzOiAkb3RoZXJwaWRzIgp3aGlsZSByZWFkIC1yIG9waWQ7IGRvCiAgICBraWxsICRvcGlkIDI+L2Rldi9udWxsCmRvbmUgPDw8IiR7b3RoZXJwaWRzfSIKCmluc3RhbGxwa2dzKCkgewogICAgU2NyaXB0TG9nICJQcmVwYXJpbmcgSW5zdGFsbGF0aW9uIG9mICR7ZGlzcGxheW5hbWV9IgoKICAgIGZvciBwa2cgaW4gIiR7cGtnYXJyYXlbQF19IgogICAgZG8KICAgICAgICBpZiBbICEgLWYgIiR7SkFNRl9DQUNIRX0vJHtwa2d9IiBdOyB0aGVuCiAgICAgICAgICAgIFNjcmlwdExvZyAiRmlsZSBcIiR7SkFNRl9DQUNIRX0vJHtwa2d9XCIgZG9lc24ndCBleGlzdC4iCiAgICAgICAgICAgIHJlbW92ZUxhdW5jaERhZW1vbgogICAgICAgICAgICBleGl0IDEKICAgICAgICBmaQogICAgZG9uZQoKICAgIGlmIFtbICIke2xvZ2dlZEluVXNlcn0iID0gInJvb3QiIF1dOyB0aGVuCiAgICAgICAgZWNobyAiTm8gVXNlciBsb2dnZWQgaW4uIFNraXBwaW5nIG5vdGlmaWNhdGlvbi4iCiAgICBlbHNlCiAgICAgICAgU2NyaXB0TG9nICJNYW5hZ2VtZW50IEFjdGlvbjogU3RhcnRlIEluc3RhbGxhdGlvbiB2b24gJHtkaXNwbGF5bmFtZX0uIgogICAgICAgICIke01BTkFHRU1FTlRfQUNUSU9OfSIgLXRpdGxlICJJbnN0YWxsYXRpb25zdGF0dXMiIC1tZXNzYWdlICJTdGFydGUgSW5zdGFsbGF0aW9uIHZvbiAke2Rpc3BsYXluYW1lfS4iICYKICAgIGZpCgogICAgZm9yIHBrZyBpbiAiJHtwa2dhcnJheVtAXX0iCiAgICBkbwogICAgICAgIFNjcmlwdExvZyAiSW5zdGFsbGluZyBcIiR7SkFNRl9DQUNIRX0vJHtwa2d9XCIiCiAgICAgICAgIiR7SkFNRn0iIGluc3RhbGwgLXBhY2thZ2UgIiR7cGtnfSIgLXBhdGggIiR7SkFNRl9DQUNIRX0iIC10YXJnZXQgLyA+PiAvdmFyL2xvZy9tYWdpYy5sb2cgMj4mMQogICAgICAgIGV4aXRjb2RlPSQ/CiAgICAgICAgU2NyaXB0TG9nICJJbnN0YWxsZXIgZG9uZSB3aXRoIGV4aXRjb2RlICRleGl0Y29kZSIKICAgICAgICBbWyAiJHsjcGtnYXJyYXlbQF19IiAtZ3QgMSBdXSAmJiAvYmluL3NsZWVwIDIKICAgIGRvbmUKICAgIGVjaG8gLW4gIiIgPiAiJHtza2lwcGluZ19jb3VudGVyfSIKCiAgICBpZiBbWyAiJHtsb2dnZWRJblVzZXJ9IiA9ICJyb290IiBdXTsgdGhlbgogICAgICAgIGVjaG8gIk5vIFVzZXIgbG9nZ2VkIGluLiBTa2lwcGluZyBub3RpZmljYXRpb24uIgogICAgZWxzZQogICAgICAgIFNjcmlwdExvZyAiTWFuYWdlbWVudCBBY3Rpb246IEluc3RhbGxhdGlvbiB2b24gJHtkaXNwbGF5bmFtZX0gZXJmb2xncmVpY2guIgogICAgICAgICIke01BTkFHRU1FTlRfQUNUSU9OfSIgLXRpdGxlICJJbnN0YWxsYXRpb25zdGF0dXMiIC1tZXNzYWdlICJJbnN0YWxsYXRpb24gdm9uICR7ZGlzcGxheW5hbWV9IGVyZm9sZ3JlaWNoLiIgJgogICAgZmkKCiAgICBTY3JpcHRMb2cgIkZlcnRpZy4iCn0KCnJlbW92ZUxhdW5jaERhZW1vbigpIHsKICAgIFNjcmlwdExvZyAiUmVtb3ZpbmcgTGF1bmNoRGFlbW9uIFwiJHtpZGVudGlmaWVyfS5tYWdpY19pbnN0YWxsZXJfJHthcHBuYW1lfS5wbGlzdFwiIgogICAgbGF1bmNoY3RsIGxpc3QgIiR7aWRlbnRpZmllcn0ubWFnaWNfaW5zdGFsbGVyXyR7YXBwbmFtZX0iID4gL2Rldi9udWxsIDI+JjEKICAgIGxhdW5jaGN0bEVycm9yPSQ/CiAgICBpZiBbWyAiJHtsYXVuY2hjdGxFcnJvcn0iIC1lcSAwIF1dOyB0aGVuCiAgICAgICAgcm0gLWYgIi9MaWJyYXJ5L0xhdW5jaERhZW1vbnMvJHtpZGVudGlmaWVyfS5tYWdpY19pbnN0YWxsZXJfJHthcHBuYW1lfS5wbGlzdCIKICAgICAgICBsYXVuY2hjdGwgcmVtb3ZlICIke2lkZW50aWZpZXJ9Lm1hZ2ljX2luc3RhbGxlcl8ke2FwcG5hbWV9IgogICAgZmkKfQoKaWYKICAgIFtbIC1uICIke2FwcFZlcnNpb25PbGR9IiBdXSAmJgogICAgW1sgLW4gIiR7YXBwVmVyc2lvbn0iIF1dICYmCiAgICAkKGNvbXBhcmVWZXJzaW9uICIke2FwcFZlcnNpb25PbGR9IiAiJHthcHBWZXJzaW9ufSIpOwogICAgdGhlbgogICAgICAgIFNjcmlwdExvZyAiU2FtZSBvciBuZXdlciBWZXJzaW9uIGFscmVhZHkgaW5zdGFsbGVkIgogICAgICAgIGVjaG8gIlNhbWUgb3IgbmV3ZXIgVmVyc2lvbiBhbHJlYWR5IGluc3RhbGxlZCIKICAgICAgICByZW1vdmVMYXVuY2hEYWVtb24KICAgICAgICBleGl0IDEwCmZpCgpmb3IgYXBwIGluICIke2FwcGFycmF5W0BdfSI7IGRvCiAgICB3YXRjaGVkUElEKz0oICQocGdyZXAgLWkgIiR7YXBwfSIgfCBncmVwIC12ICJncmVwIiB8IGdyZXAgLXYgIm1hZ2ljX2luc3RhbGxlciIpICkKZG9uZQplY2hvICJ3YXRjaGVkUElEOiAke3dhdGNoZWRQSURbKl19IgppZiBbWyAiJHt3YXRjaGVkUElEWypdLyMgL30iID09ICIiIF1dOyB0aGVuCiAgICBTY3JpcHRMb2cgIlN0YXJ0aW5nIGluc3RhbGxhdGlvbi4iCiAgICBpbnN0YWxscGtncwogICAgcmVtb3ZlTGF1bmNoRGFlbW9uCmVsc2UKICAgIGlmIFtbICIke2RlYWRsaW5lfSIgLWd0IDAgXV07IHRoZW4KICAgICAgICAjIFNjcmlwdExvZyAiZm9yY2VkIGluc3RhbGxhdGlvbiB3aWxsIGJlIGFjdGl2YXRlZC4iCiAgICAgICAgZWNobyAiZm9yY2VkIGluc3RhbGxhdGlvbiB3aWxsIGJlIGFjdGl2YXRlZC4iCiAgICAgICAgbm9yZXJ1bmJlZm9yZT0iJCh0YWlsIC1uIDEgIiR7c2tpcHBpbmdfY291bnRlcn0iKSIKICAgICAgICBsb2dSZXBlYXQ9JChncmVwICIke2Rpc3BsYXluYW1lfSIgIiR7bG9nRmlsZX0iIDI+L2Rldi9udWxsIHwgdGFpbCAtbiAxIHwgZ3JlcCAtYyAibm9yZXJ1bmJlZm9yZSIpCiAgICAgICAgW1sgLXogIiR7bm9yZXJ1bmJlZm9yZX0iIF1dICYmIG5vcmVydW5iZWZvcmU9MAogICAgICAgIFtbICIke2xvZ1JlcGVhdH0iIC1lcSAwIF1dICYmIFNjcmlwdExvZyAibm9yZXJ1bmJlZm9yZTogJChkYXRlIC1yICR7bm9yZXJ1bmJlZm9yZX0gKyIlZC4lbS4lWSAlSDolTTolUyIpIgogICAgICAgICMgU2NyaXB0TG9nICJub3c6ICAgICAgICAgICAkKGRhdGUgLXIgJHtub3d9ICsiJWQuJW0uJVkgJUg6JU06JVMiKSIKICAgICAgICBlY2hvICJub3c6ICAgICAgICAgICAkKGRhdGUgLXIgJHtub3d9ICsiJWQuJW0uJVkgJUg6JU06JVMiKSIKICAgICAgICBpZgogICAgICAgICAgICBbWyAiJHtub3JlcnVuYmVmb3JlfSIgLWxlICIke25vd30iIF1dOwogICAgICAgICAgICB0aGVuCiAgICAgICAgICAgICAgICBza2lwcGluZ19jb3VudGVyX2ludD0iJCh3YyAtbCAiJHtza2lwcGluZ19jb3VudGVyfSIgfCBhd2sgJ3twcmludCAkMSsxfScpIgogICAgICAgICAgICAgICAgU2NyaXB0TG9nICIjd2FpdGluZ19kdXJhdGlvbltAXTogJHsjd2FpdGluZ19kdXJhdGlvbltAXX0iCiAgICAgICAgICAgICAgICBTY3JpcHRMb2cgInNraXBwaW5nX2NvdW50ZXJfaW50OiAkc2tpcHBpbmdfY291bnRlcl9pbnQiCgogICAgICAgICAgICAgICAgaWYKICAgICAgICAgICAgICAgICAgICBbWyAiJHsjd2FpdGluZ19kdXJhdGlvbltAXX0iIC1ndCAiJHtza2lwcGluZ19jb3VudGVyX2ludH0iIF1dICYmCiAgICAgICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgICAgICBbWyAiJHtkZWFkbGluZX0iIC1lcSAwIF1dIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIFtbICIke2RlYWRsaW5lfSIgLWdlICIke25vd30iIF1dCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9IiR7d2FpdGluZ19kdXJhdGlvblskc2tpcHBpbmdfY291bnRlcl9pbnQtMV19IgogICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWw9InRydWUiCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9IiR7d2FpdGluZ19kdXJhdGlvblskeyN3YWl0aW5nX2R1cmF0aW9uW0BdfS0xXX0iICMgbGFzdCBhcnJheSBpdGVtCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbD0iZmFsc2UiCiAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICAgICAgU2NyaXB0TG9nICJ0aW1lb3V0OiAkdGltZW91dCIKICAgICAgICAgICAgICAgIFNjcmlwdExvZyAiY2FuY2VsOiAkY2FuY2VsIgoKICAgICAgICAgICAgICAgIFNjcmlwdExvZyAiQXBwbGljYXRpb24gXCIke2FwcG5hbWV9XCIgaXMgcnVubmluZy4uLiIKICAgICAgICAgICAgICAgIFNjcmlwdExvZyAiRGlzcGxheSBtZXNzYWdlIGZvciB1c2VyIFwiJHtjdXJyZW50dXNlcn1cIiIKICAgICAgICAgICAgICAgIGRpc3BsYXlVc2VyTWVzc2FnZSAiQml0dGUgYmVlbmRlbiBTaWUgJHtkaXNwbGF5bmFtZX0sIHVtIFNvZnR3YXJlYWt0dWFsaXNpZXJ1bmdlbiBkdXJjaHp1ZsO8aHJlbi4iICIke3RpbWVvdXR9IiAiJHtjYW5jZWx9IiA+IC9kZXYvbnVsbAogICAgICAgICAgICAgICAgZXJyb3Jjb2RlPSIkPyIKICAgICAgICAgICAgICAgIGlmIFtbICIke2Vycm9yY29kZX0iIC1lcSAwIF1dOyB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIGFwcCBpbiAiJHthcHBhcnJheVtAXX0iOyBkbwogICAgICAgICAgICAgICAgICAgICAgICBTY3JpcHRMb2cgIlF1aXRpbmcgXCIkYXBwXCIgd2l0aCBBcHBsZVNjcmlwdCIKICAgICAgICAgICAgICAgICAgICAgICAgb3Nhc2NyaXB0IC1lICJ0ZWxsIGFwcGxpY2F0aW9uIFwiJHthcHB9XCIgdG8gcXVpdCIKICAgICAgICAgICAgICAgICAgICBkb25lCiAgICAgICAgICAgICAgICAgICAgL2Jpbi9zbGVlcCAyCgogICAgICAgICAgICAgICAgICAgIHBzICR7d2F0Y2hlZFBJRFsqXX0gPi9kZXYvbnVsbCAyPiYxCiAgICAgICAgICAgICAgICAgICAgcHNlcnJvcj0kPwogICAgICAgICAgICAgICAgICAgIGlmIFtbICIke3BzZXJyb3J9IiAtZXEgMCBdXTsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBTY3JpcHRMb2cgIktpbGxpbmcgXCIke2Rpc3BsYXluYW1lfVwiICgke3dhdGNoZWRQSURbKl19KSIKICAgICAgICAgICAgICAgICAgICAgICAga2lsbCAtOSAke3dhdGNoZWRQSURbKl19IDI+L2Rldi9udWxsCiAgICAgICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBlY2hvICIkKCggbm93ICsgdGltZW91dCApKSIgPj4gIiR7c2tpcHBpbmdfY291bnRlcn0iCiAgICAgICAgICAgICAgICAgICAgU2NyaXB0TG9nICJNYW51YWwgc2tpcHBlZC4iCiAgICAgICAgICAgICAgICAgICAgbm93Mj0iJChkYXRlICslcykiCiAgICAgICAgICAgICAgICAgICAgdGltZW91dDI9JCgoIHRpbWVvdXQgLSAoIG5vdzIgLSBub3cgKSApKQogICAgICAgICAgICAgICAgZmkKICAgICAgICBlbHNlCiAgICAgICAgICAgIG5vdzI9IiQoZGF0ZSArJXMpIgogICAgICAgICAgICB0aW1lb3V0Mj0kKCggbm9yZXJ1bmJlZm9yZSAtIG5vdzIgKSkKICAgICAgICAgICAgIyBTY3JpcHRMb2cgIlNraXBwaW5nLiBOZXh0IHJ1biBhdCAkKGRhdGUgLXIgJHtub3JlcnVuYmVmb3JlfSArIiVkLiVtLiVZICVIOiVNOiVTIikiCiAgICAgICAgZmkKICAgIGVsc2UKICAgICAgICBsb2dnZWRJblVzZXI9JCgvYmluL2xzIC1sIC9kZXYvY29uc29sZSB8IC91c3IvYmluL2F3ayAneyBwcmludCAkMyB9JykKICAgICAgICBsb2dSZXBlYXQ9JChncmVwICIke2Rpc3BsYXluYW1lfSIgIiR7bG9nRmlsZX0iIDI+L2Rldi9udWxsIHwgdGFpbCAtbiAxIHwgZ3JlcCAtYyAiaXMgbG9nZ2VkIGluIGFuZCBhcHAgaXMgcnVubmluZyIpCiAgICAgICAgW1sgIiR7bG9nUmVwZWF0fSIgLWVxIDAgXV0gJiYgU2NyaXB0TG9nICJVc2VyIFwiJHtsb2dnZWRJblVzZXJ9XCIgaXMgbG9nZ2VkIGluIGFuZCBhcHAgaXMgcnVubmluZy4gRXhpdGluZy4iCiAgICBmaQoKZmkKCmV4aXQgMA==
" | base64 -D -o "${path}/magic_installer.sh"

appname="${4}"

chown -R root:admin "${path}/magic_installer.sh"
chmod +x "${path}/magic_installer.sh"

launchctl list ${identifier}.magic_installer_${appname} > /dev/null 2>&1
launchctlError=$?
if [[ "${launchctlError}" -eq 0 ]]; then
    rm -f "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
    launchctl remove ${identifier}.magic_installer_${appname}
fi

cat <<EOF > "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>Label</key>
	<string>${identifier}.magic_installer_${appname}</string>
	<key>RunAtLoad</key>
	<true/>
	<key>ProgramArguments</key>
	<array>
		<string>/bin/bash</string>
		<string>${path}/magic_installer.sh</string>
		<string>${1}</string>
		<string>${2}</string>
		<string>${3}</string>
		<string>${4}</string>
		<string>${5}</string>
		<string>${6}</string>
		<string>${7}</string>
		<string>${8}</string>
		<string>${9}</string>
		<string>${10}</string>
		<string>${11}</string>
	</array>
    <key>StartInterval</key>
    <integer>10</integer>
</dict>
</plist>
EOF

chown -R root:admin "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
chmod +x "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"

launchctl load -w "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
