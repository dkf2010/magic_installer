#!/bin/zsh
# Dennis Philipps, 2018-2023

path="/Library/Application Support/Scripts" # Edit me
[[ -d "${path}" ]] || mkdir -p "${path}"

identifier="com.mycompany" # Edit me

echo "
IyEvYmluL3pzaAojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIERlbm5pcyBQaGlsaXBwcywgMjAxOC0yMDIzCiMKIyB3aXRoIGNvbnRlbnQgZnJvbQojICAgaHR0cHM6Ly9naXRodWIuY29tL2hvbWVieXNpeC9hdXRvLXVwZGF0ZS1tYWdpYwojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMKIyBUaGlzIHNjcmlwdCBpcyBkZXNpZ25lZCB0byBiZSBlbWJlZGRlZCBpbiBhIGhlbHBlciBzY3JpcHQgIm1hZ2ljX2luc3RhbGxlcl9jb250YWluZXIuc2giLgojIGJhc2U2NCAtaSAuL21hZ2ljX2luc3RhbGxlci5zaCB8IHBiY29weQojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgTkFNRQojICAgbWFnaWNfaW5zdGFsbGVyLnNoIC0tIHNjcmlwdCBmb3IgbWFuYWdlZCBpbnN0YWxsYXRpb24gdGhyb3VnaCBqYW1mIHByby4KIyAKIyBTWU5PUFNJUwojICAgLi9tYWdpY19pbnN0YWxsZXIuc2ggPG1vdW50UG9pbnQ+IDxjb21wdXRlck5hbWU+IDx1c2VyTmFtZT4gIjxwcm9jZXNzTmFtZT5bOzxwcm9jZXNzTmFtZT47Li4uXSIgIls8YXBwVmVyc2lvbj5dIiAiWzxkaXNwbGF5bmFtZT5dIiAiPHBrZ1RvSW5zdGFsbD5bOzxwa2dUb0luc3RhbGw+Oy4uLl0iIFs8ZGVhZGxpbmU+XSBbPGljb24+XSBbYXBwVmVyc2lvbk9sZF0KIyAKIyBERVNDUklQVElPTgojICAgbW91bnRQb2ludAojICAgICAgIHRhcmdldCBmb3IgaW5zdGFsbGVyCiMgICAgICAgV2lsbCBiZSBhdXRvbWF0aWNhbGx5IHNldCBmcm9tIGphbWYgcHJvCiMgICAgICAgRXhhbXBsZToKIyAgICAgICAgICIvIgojIAojICAgY29tcHV0ZXJOYW1lCiMgICAgICAgaG9zdG5hbWUgZnJvbSB0aGUgZGVzdGluYXRpb24gY29tcHV0ZXIKIyAgICAgICBXaWxsIGJlIGF1dG9tYXRpY2FsbHkgc2V0IGZyb20gamFtZiBwcm8KIyAgICAgICBFeGFtcGxlOgojICAgICAgICAgIk1CUDIwMTctMDAxIgojCiMgICB1c2VyTmFtZQojICAgICAgIGxvZ2dlZCBpbiB1c2VyCiMgICAgICAgV2lsbCBiZSBhdXRvbWF0aWNhbGx5IHNldCBmcm9tIGphbWYgcHJvCiMgICAgICAgRXhhbXBsZToKIyAgICAgICAgICJDbGFyYS5Lb3JuIgojIAojICAgcHJvY2Vzc05hbWUKIyAgICAgICBwcm9jZXNzIHRvIHdhdGNoLiBVc2UgOyBhcyBkZWxpbWl0ZXIgZm9yIG11bHRpcGxlIHByb2Nlc3MgbmFtZXMKIyAgICAgICBFeGFtcGxlOgojICAgICAgICAgImZpcmVmb3giCiMgICAgICAgICAiZmlyZWZveDtzYWZhcmkkIgojCiMgICBhcHBWZXJzaW9uIChPcHRpb25hbCkKIyAgICAgICBWZXJzaW9uIE51bWJlciBmcm9tIHRoZSBhcHAgd2hpY2ggd2lsbCBiZSBpbnN0YWxsZWQuCiMgICAgICAgRXhhbXBsZToKIyAgICAgICAgICI1Mi43LjMiCiMKIyAgIGRpc3BsYXluYW1lIChPcHRpb25hbCkKIyAgICAgICBOYW1lIHdoaWNoIGJlIHVzZWQgZm9yIG5vdGlmaWNhdGlvbnMKIyAgICAgICBFeGFtcGxlOgojICAgICAgICAgIkZpcmVmb3ggd2l0aCBDQ0siCiMKIyAgIHBrZ1RvSW5zdGFsbAojICAgICAgIFBLR3MgY2FjaGVkIGluIHRoZSBKQU1GICJXYWl0aW5nIFJvb20iLiBVc2UgOyBhcyBkZWxpbWl0ZXIgZm9yIG11bHRpcGxlIFBhY2thZ2VzIHRvIGluc3RhbGwuCiMgICAgICAgRXhhbXBsZToKIyAgICAgICAgICJNeVBhY2thZ2UtMS4wLjAucGtnIgojICAgICAgICAgIk15UGFja2FnZS0xLjAuMC5wa2c7TXlQYWNrYWdlVXBkYXRlLTEuMS4wLnBrZyIKIyAKIyAgIGRlYWRsaW5lIChPcHRpb25hbCkKIyAgICAgICBkYXRlIGFzIHVuaXggdGltZXN0YW1wIG9mIHRoZSBmb3JjZWQgaW5zdGFsbC4gQWZ0ZXIgdGhpcyBkYXRlIHRoZSBjb3VudGRvd24gd2lsbCBiZSBpZ25vcmVkLgojICAgICAgIElmIHRoZSBkZWFkbGluZSBpcyBzZXQsIHRoZSBmb3JjZWQgaW5zdGFsbCB3aWxsIGJlIGFjdGl2YXRlZC4KIyAgICAgICBjYWxjdWxhdGUgdGhlIGRlYWRsaW5lOgojICAgICAgIGRhdGUgLWogLWYgIiVkLiVtLiVZICVIOiVNOiVTIiAiMzEuMTIuMjAxOCAwNjowMDowMCIgKyVzCiMgICAgICAgRXhhbXBsZToKIyAgICAgICAgICIxNTQ2MjMyNDAwIgojCiMgICBpY29uIChPcHRpb25hbCkKIyAgICAgICBUaGlzIGljb24gd2lsbCBiZSB1c2VkIGZvciB0aGUgbWVzc2FnZWJveAojICAgICAgIEV4YW1wbGU6CiMgICAgICAgICAiL0FwcGxpY2F0aW9ucy9GaXJlZm94LmFwcC9Db250ZW50cy9SZXNvdXJjZXMvZmlyZWZveC5pY25zIgojCiMgICBhcHBWZXJzaW9uT2xkIChPcHRpb25hbCkKIyAgICAgICBkZWZpbmUgdGhlICJkZWZhdWx0cyByZWFkIiBwYXJhbWV0ZXIgdG8gZGV0ZXJtaW5lIHRoZSB2ZXJzaW9uIGZyb20gdGhlIG9sZCBpbnN0YWxsZWQgYXBwLgojICAgICAgIEV4YW1wbGU6CiMgICAgICAgICAiL0FwcGxpY2F0aW9ucy9GaXJlZm94LmFwcC9Db250ZW50cy9JbmZvLnBsaXN0IiBDRkJ1bmRsZVNob3J0VmVyc2lvblN0cmluZwojICAgICAgICAgZGVmYXVsdHMgcmVhZCAvQXBwbGljYXRpb25zL0ZpcmVmb3guYXBwL0NvbnRlbnRzL0luZm8ucGxpc3QgQ0ZCdW5kbGVTaG9ydFZlcnNpb25TdHJpbmcKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmxvZ0ZpbGU9Ii92YXIvbG9nL21hZ2ljX2luc3RhbGxlci5sb2ciClNjcmlwdExvZygpIHsgIyBSZS1kaXJlY3QgbG9nZ2luZyB0byB0aGUgbG9nIGZpbGUgLi4uCglpZiBbWyAhIC16ICIke2xvZ0ZpbGV9IiBdXSAmJiBbWyAhIC1mICIke2xvZ0ZpbGV9IiBdXTsgdGhlbgoJCS91c3IvYmluL3RvdWNoICIke2xvZ0ZpbGV9IiB8fCBleGl0IDEKCWVsaWYgW1sgLXogIiR7bG9nRmlsZX0iIF1dOyB0aGVuCgkJbG9nRmlsZT0iL3Zhci9sb2cvc3lzdGVtLmxvZyIKCQkvdXNyL2Jpbi90b3VjaCAiJHtsb2dGaWxlfSIgfHwgZXhpdCAxCglmaQoKICAgIGV4ZWMgMz4mMSA0PiYyICAgICAgICAgICMgU2F2ZSBzdGFuZGFyZCBvdXRwdXQgYW5kIHN0YW5kYXJkIGVycm9yCiAgICBleGVjIDE+PiIke2xvZ0ZpbGV9IiAgICAjIFJlZGlyZWN0IHN0YW5kYXJkIG91dHB1dCB0byBsb2dGaWxlCiAgICBleGVjIDI+PiIke2xvZ0ZpbGV9IiAgICAjIFJlZGlyZWN0IHN0YW5kYXJkIGVycm9yIHRvIGxvZ0ZpbGUKCiAgICBTY3JpcHRMb2dOT1c9JChkYXRlICslWS0lbS0lZFwgJUg6JU06JVMpCiAgICAvYmluL2VjaG8gIlske2Rpc3BsYXluYW1lfSB8ICR7U2NyaXB0TG9nTk9XfV0gICR7MX0iID4+ICR7bG9nRmlsZX0KCWV4ZWMgMT4mMyAyPiY0Cn0KCnJlbW92ZUxhdW5jaERhZW1vbigpIHsKICAgIFNjcmlwdExvZyAiUmVtb3ZpbmcgTGF1bmNoRGFlbW9uIFwiJHtpZGVudGlmaWVyfS5tYWdpY19pbnN0YWxsZXJfJHthcHBuYW1lfS5wbGlzdFwiIgogICAgbGF1bmNoY3RsIGxpc3QgIiR7aWRlbnRpZmllcn0ubWFnaWNfaW5zdGFsbGVyXyR7YXBwbmFtZX0iID4gL2Rldi9udWxsIDI+JjEKICAgIGxhdW5jaGN0bEVycm9yPSQ/CiAgICBpZiBbWyAiJHtsYXVuY2hjdGxFcnJvcn0iIC1lcSAwIF1dOyB0aGVuCiAgICAgICAgcm0gLWYgIi9MaWJyYXJ5L0xhdW5jaERhZW1vbnMvJHtpZGVudGlmaWVyfS5tYWdpY19pbnN0YWxsZXJfJHthcHBuYW1lfS5wbGlzdCIKICAgICAgICBsYXVuY2hjdGwgcmVtb3ZlICIke2lkZW50aWZpZXJ9Lm1hZ2ljX2luc3RhbGxlcl8ke2FwcG5hbWV9IgogICAgZmkKfQoKSkFNRj0iL3Vzci9sb2NhbC9iaW4vamFtZiIKSkFNRl9IRUxQRVI9Ii9MaWJyYXJ5L0FwcGxpY2F0aW9uIFN1cHBvcnQvSkFNRi9iaW4vamFtZkhlbHBlci5hcHAvQ29udGVudHMvTWFjT1MvamFtZkhlbHBlciIKSkFNRl9JQ09OUz0iL0xpYnJhcnkvQXBwbGljYXRpb24gU3VwcG9ydC9KQU1GL2Jpbi9qYW1mSGVscGVyLmFwcC9Db250ZW50cy9SZXNvdXJjZXMiCk1BTkFHRU1FTlRfQUNUSU9OPSIvTGlicmFyeS9BcHBsaWNhdGlvbiBTdXBwb3J0L0pBTUYvYmluL01hbmFnZW1lbnQgQWN0aW9uLmFwcC9Db250ZW50cy9NYWNPUy9NYW5hZ2VtZW50IEFjdGlvbiIKSkFNRl9DQUNIRT0iL0xpYnJhcnkvQXBwbGljYXRpb24gU3VwcG9ydC9KQU1GL1dhaXRpbmcgUm9vbSIKY3VycmVudHVzZXI9JChscyAtbCAvZGV2L2NvbnNvbGUgfCBjdXQgLWQgIiAiIC1mIDQpCmlkZW50aWZpZXI9ImNvbS5teWNvbXBhbnkiICMgRG8gbm90IGVkaXQuIFdpbGwgYmUgbW9kaWZpZWQgYnkgdGhlIGNvbnRhaW5lciBzY3JpcHQuCnNraXBwaW5nX2NvdW50ZXJfZGlyPSIvTGlicmFyeS9BcHBsaWNhdGlvbiBTdXBwb3J0L1NjcmlwdHMvbWFnaWNfaW5zdGFsbGVyIiAjIERvIG5vdCBlZGl0LiBXaWxsIGJlIG1vZGlmaWVkIGJ5IHRoZSBjb250YWluZXIgc2NyaXB0LgpbWyAtZCAiJHtza2lwcGluZ19jb3VudGVyX2Rpcn0iIF1dIHx8IG1rZGlyIC1wICIke3NraXBwaW5nX2NvdW50ZXJfZGlyfSIKd2FpdGluZ19kdXJhdGlvbj0oIDg2NDAwIDE0NDAwIDcyMDAgMTgwMCAzMDAgKSAjIDAgd2lsbCBkZWFjdGl2YXRlIHRoZSBjb3VudGRvd24Kbm93PSIkKGRhdGUgKyVzKSIKCmRpc3BsYXlVc2VyTWVzc2FnZSAoKSB7CglNWV9NRVNTQUdFPSIkezF9IgoJW1sgLXogIiR7Mn0iIF1dICYmIHRpbWVvdXQ9IjcyMDAiIHx8IHRpbWVvdXQ9IiR7Mn0iCglbWyAteiAiJHszfSIgXV0gJiYgY2FuY2VsPSJmYWxzZSIgfHwgY2FuY2VsPSIkezN9IgoJaWYKICAgICAgICBbWyAtbiAiJHtjdXN0b21pY29ufSIgXV0gJiYKICAgICAgICBbWyAtZiAiJHtjdXN0b21pY29ufSIgXV07CiAgICAgICAgdGhlbgoJCWljb249IiR7Y3VzdG9taWNvbn0iCgllbGlmCiAgICAgICAgW1sgLWYgIi9TeXN0ZW0vTGlicmFyeS9Db3JlU2VydmljZXMvU29mdHdhcmUgVXBkYXRlLmFwcC9Db250ZW50cy9SZXNvdXJjZXMvU29mdHdhcmVVcGRhdGUuaWNucyIgXV07CiAgICAgICAgdGhlbgoJCWljb249Ii9TeXN0ZW0vTGlicmFyeS9Db3JlU2VydmljZXMvU29mdHdhcmUgVXBkYXRlLmFwcC9Db250ZW50cy9SZXNvdXJjZXMvU29mdHdhcmVVcGRhdGUuaWNucyIKCWVsaWYKICAgICAgICBbWyAtZiAiL1N5c3RlbS9MaWJyYXJ5L0NvcmVTZXJ2aWNlcy9JbnN0YWxsIENvbW1hbmQgTGluZSBEZXZlbG9wZXIgVG9vbHMuYXBwL0NvbnRlbnRzL1Jlc291cmNlcy9Tb2Z0d2FyZVVwZGF0ZS5pY25zIiBdXTsKICAgICAgICB0aGVuCgkJaWNvbj0iL1N5c3RlbS9MaWJyYXJ5L0NvcmVTZXJ2aWNlcy9JbnN0YWxsIENvbW1hbmQgTGluZSBEZXZlbG9wZXIgVG9vbHMuYXBwL0NvbnRlbnRzL1Jlc291cmNlcy9Tb2Z0d2FyZVVwZGF0ZS5pY25zIgoJZWxzZQoJCWljb249IiR7SkFNRl9JQ09OU30vTWVzc2FnZS5wbmciCglmaQoJaWYgW1sgIiR7Y2FuY2VsfSIgPSAiZmFsc2UiIF1dOyB0aGVuCgkJIiR7SkFNRl9IRUxQRVJ9IiBcCgkJCS13aW5kb3dUeXBlIHV0aWxpdHkgXAoJCQktdGl0bGUgIlN5c3RlbXVwZGF0ZXMgdmVyZsO8Z2JhciIgXAoJCQktZGVzY3JpcHRpb24gIiR7TVlfTUVTU0FHRX0iIFwKCQkJLWljb24gIiR7aWNvbn0iIFwKCQkJLWJ1dHRvbjEgIkluc3RhbGxpZXJlbiIgXAoJCQktZGVmYXVsdEJ1dHRvbiAxIFwKCQkJLXRpbWVvdXQgJHt0aW1lb3V0fSBcCgkJCS1jb3VudGRvd24KCWVsc2UKCQkiJHtKQU1GX0hFTFBFUn0iIFwKCQkJLXdpbmRvd1R5cGUgdXRpbGl0eSBcCgkJCS10aXRsZSAiU3lzdGVtdXBkYXRlcyB2ZXJmw7xnYmFyIiBcCgkJCS1kZXNjcmlwdGlvbiAiJHtNWV9NRVNTQUdFfSIgXAoJCQktaWNvbiAiJHtpY29ufSIgXAoJCQktYnV0dG9uMSAiSW5zdGFsbGllcmVuIiBcCgkJCS1idXR0b24yICJTcMOkdGVyIiBcCgkJCS1kZWZhdWx0QnV0dG9uIDEgXAoJCQktY2FuY2VsQnV0dG9uIDIgXAoJCQktdGltZW91dCAke3RpbWVvdXR9IFwKCQkJLWNvdW50ZG93bgoJIGZpCgp9Cgpjb21wYXJlVmVyc2lvbiAoKSB7CiAgICB2ZXJzaW9ucz0oJDEgJDIpCgogICAgIyBTb3J0IHRoZSB2ZXJzaW9ucyB1c2luZyB2ZXJzaW9uIHNvcnQKICAgIHNvcnRlZF92ZXJzaW9ucz0oIiR7KEBvbil2ZXJzaW9uc30iKQoKICAgICMgR2V0IHRoZSBsYXRlc3QgdmVyc2lvbiAobGFzdCBlbGVtZW50IGFmdGVyIHNvcnRpbmcpCiAgICBsYXRlc3RfdmVyc2lvbj0iJHtzb3J0ZWRfdmVyc2lvbnNbLTFdfSIKCiAgICAjIENoZWNrIGlmIHRoZSBnaXZlbiB2ZXJzaW9ucyBhcmUgZXF1YWwgdG8gdGhlIGxhdGVzdCB2ZXJzaW9uCiAgICBpZiBbWyAkMSA9PSAkbGF0ZXN0X3ZlcnNpb24gJiYgJDIgPT0gJGxhdGVzdF92ZXJzaW9uIF1dOyB0aGVuCiAgICAgICAgIyBCb3RoIHZlcnNpb25zIGFyZSBlcXVhbAogICAgICAgIHJldHVybiAwCiAgICBlbGlmIFtbICQxID09ICRsYXRlc3RfdmVyc2lvbiBdXTsgdGhlbgogICAgICAgICMgbmV3ZXN0IHZlcnNpb24gYWxyZWFkeSBpbnN0YWxsZWQKICAgICAgICByZXR1cm4gMAogICAgZWxzZQogICAgICAgICMgbmV3ZXIgdmVyc2lvbiBhdmFpbGFibGUKICAgICAgICByZXR1cm4gMQogICAgZmkKfQoKaWYgWyAtbiAiJHs0fSIgXTsgdGhlbgoJYXBwbmFtZT0iJHs0fSIKZWxzZQoJZWNobyAiRXJyb3I6IFByb2Nlc3NuYW1lIG5vdCBzZXQgKGhpbnQ6IGFyZ3VtZW50ICM0KSIgMT4mMgogICAgZWNobyAiUHJvY2Vzc25hbWUgKHVzZSA7IGFzIGRlbGltaXRlcikiCglleGl0IDQKZmkKCmlmIFsgLW4gIiR7NX0iIF07IHRoZW4KCWFwcFZlcnNpb249IiR7NX0iCmVsc2UKCWFwcFZlcnNpb249IiIKZmkKCmlmIFsgLW4gIiR7Nn0iIF07IHRoZW4KCWRpc3BsYXluYW1lPSIkezZ9IgplbHNlCgllY2hvICJJbmZvOiBEaXNwbGF5bmFtZSBub3Qgc2V0IChoaW50OiBhcmd1bWVudCAjNikuIFVzaW5nIEFwcG5hbWUgXCIke2FwcG5hbWV9XCIgYW5kIGFwcFZlcnNpb24gXCIke2FwcFZlcnNpb259XCIgYXMgZGlzcGxheW5hbWUuIgoJaWYgW1sgLW4gIiR7YXBwVmVyc2lvbn0iIF1dOyB0aGVuCiAgICAgICAgZGlzcGxheW5hbWU9IiR7YXBwbmFtZX0gJHthcHBWZXJzaW9ufSIKICAgIGVsc2UKCSAgICBkaXNwbGF5bmFtZT0iJHthcHBuYW1lfSIKICAgIGZpCiAgICBlY2hvICJEaXNwbGF5bmFtZTogXCIke2Rpc3BsYXluYW1lfVwiIgpmaQoKaWYgWyAtbiAiJHs3fSIgXTsgdGhlbgoJcGtncz0iJHs3fSIKZWxzZQoJZWNobyAiRXJyb3I6IFBLR3MgdG8gaW5zdGFsbCBub3Qgc2V0IChoaW50OiBhcmd1bWVudCAjNykiIDE+JjIKICAgIGVjaG8gIlBLR3MgdG8gaW5zdGFsbCAodXNlIDsgYXMgZGVsaW1pdGVyKSIKCWV4aXQgNwpmaQoKc2tpcHBpbmdfY291bnRlcj0iJHtza2lwcGluZ19jb3VudGVyX2Rpcn0vJHtkaXNwbGF5bmFtZX0iCnRvdWNoICIke3NraXBwaW5nX2NvdW50ZXJ9IgoKaWYgWyAtbiAiJHs4fSIgXTsgdGhlbgoJZGVhZGxpbmU9IiR7OH0iCmVsc2UKCWRlYWRsaW5lPSIwIgpmaQpbWyAiJHtkZWFkbGluZX0iID09ICIwIiBdXSAmJiBlY2hvICJkZWFkbGluZTogbm90IHNldCIgfHwgZWNobyAiZGVhZGxpbmU6ICQoZGF0ZSAtciAke2RlYWRsaW5lfSArIiVkLiVtLiVZICVIOiVNOiVTIikiCgppZiBbIC1uICIkezl9IiBdOyB0aGVuCgljdXN0b21pY29uPSIkezl9IgpmaQoKaWYgWyAtbiAiJHsxMH0iIF07IHRoZW4KICAgIGlmIFtbIC16ICIkezExfSIgXV07IHRoZW4KICAgICAgICBwbGlzdEtleT0iQ0ZCdW5kbGVTaG9ydFZlcnNpb25TdHJpbmciCiAgICBlbHNlCiAgICAgICAgcGxpc3RLZXk9IiR7MTF9IgogICAgZmkKCWFwcFZlcnNpb25PbGQ9IiQoZGVmYXVsdHMgcmVhZCAiJHsxMH0iICIke3BsaXN0S2V5fSIgMj4vZGV2L251bGwpIgpmaQoKZGVjbGFyZSAtYSBhcHBhcnJheQpkZWNsYXJlIC1hIHBrZ2FycmF5CmFwcGxpbmVzPSQoZWNobyAiJHthcHBuYW1lfSJ8dHIgIjsiICJcbiIpCndoaWxlIHJlYWQgLXIgYXBwOyBkbwoJYXBwYXJyYXkrPSgiJGFwcCIpCmRvbmUgPDw8IiR7YXBwbGluZXN9IgoKcGtnbGluZXM9JChlY2hvICIke3BrZ3N9Inx0ciAiOyIgIlxuIikKd2hpbGUgcmVhZCAtciBwa2c7IGRvCglwa2dhcnJheSs9KCIkcGtnIikKZG9uZSA8PDwiJHtwa2dsaW5lc30iCgojIFNjcmlwdExvZyAiS2lsbGluZyBvbGQgcHJvY2Vzc2VzLiIKIyBTY3JpcHRMb2cgInNlbGZwaWQ6ICQkIgpvdGhlcnBpZHM9JCggcHMgYXV4IHwgZ3JlcCAiW21dYWdpY19pbnN0YWxsZXIiIHwgZ3JlcCAiJChlY2hvICR7YXBwbmFtZX18c2VkICdzLzsvXFx8L2cnKSIgfCBhd2sgJ3twcmludCAkMn0nIHwgZ3JlcCAtdiAiJCQiICkKIyBTY3JpcHRMb2cgIm90aGVycGlkczogJG90aGVycGlkcyIKd2hpbGUgcmVhZCAtciBvcGlkOyBkbwogICAga2lsbCAkb3BpZCAyPi9kZXYvbnVsbApkb25lIDw8PCIke290aGVycGlkc30iCgppbnN0YWxscGtncygpIHsKICAgIFNjcmlwdExvZyAiUHJlcGFyaW5nIEluc3RhbGxhdGlvbiBvZiAke2Rpc3BsYXluYW1lfSIKCiAgICBmb3IgcGtnIGluICIke3BrZ2FycmF5W0BdfSIKICAgIGRvCiAgICAgICAgaWYgWyAhIC1mICIke0pBTUZfQ0FDSEV9LyR7cGtnfSIgXTsgdGhlbgogICAgICAgICAgICBTY3JpcHRMb2cgIkZpbGUgXCIke0pBTUZfQ0FDSEV9LyR7cGtnfVwiIGRvZXNuJ3QgZXhpc3QuIgogICAgICAgICAgICByZW1vdmVMYXVuY2hEYWVtb24KICAgICAgICAgICAgZXhpdCAxCiAgICAgICAgZmkKICAgIGRvbmUKCiAgICBpZiBbWyAiJHtsb2dnZWRJblVzZXJ9IiA9ICJyb290IiBdXTsgdGhlbgogICAgICAgIGVjaG8gIk5vIFVzZXIgbG9nZ2VkIGluLiBTa2lwcGluZyBub3RpZmljYXRpb24uIgogICAgZWxzZQogICAgICAgIFNjcmlwdExvZyAiTWFuYWdlbWVudCBBY3Rpb246IFN0YXJ0ZSBJbnN0YWxsYXRpb24gdm9uICR7ZGlzcGxheW5hbWV9LiIKICAgICAgICAiJHtNQU5BR0VNRU5UX0FDVElPTn0iIC10aXRsZSAiSW5zdGFsbGF0aW9uc3RhdHVzIiAtbWVzc2FnZSAiU3RhcnRlIEluc3RhbGxhdGlvbiB2b24gJHtkaXNwbGF5bmFtZX0uIiAmCiAgICBmaQoKICAgIGZvciBwa2cgaW4gIiR7cGtnYXJyYXlbQF19IgogICAgZG8KICAgICAgICBTY3JpcHRMb2cgIkluc3RhbGxpbmcgXCIke0pBTUZfQ0FDSEV9LyR7cGtnfVwiIgogICAgICAgICIke0pBTUZ9IiBpbnN0YWxsIC1wYWNrYWdlICIke3BrZ30iIC1wYXRoICIke0pBTUZfQ0FDSEV9IiAtdGFyZ2V0IC8gPj4gIiR7bG9nRmlsZX0iIDI+JjEKICAgICAgICBleGl0Y29kZT0kPwogICAgICAgIFNjcmlwdExvZyAiSW5zdGFsbGVyIGRvbmUgd2l0aCBleGl0Y29kZSAkZXhpdGNvZGUiCiAgICAgICAgW1sgIiR7I3BrZ2FycmF5W0BdfSIgLWd0IDEgXV0gJiYgL2Jpbi9zbGVlcCAyCiAgICBkb25lCiAgICBlY2hvIC1uICIiID4gIiR7c2tpcHBpbmdfY291bnRlcn0iCgogICAgaWYgW1sgIiR7bG9nZ2VkSW5Vc2VyfSIgPSAicm9vdCIgXV07IHRoZW4KICAgICAgICBlY2hvICJObyBVc2VyIGxvZ2dlZCBpbi4gU2tpcHBpbmcgbm90aWZpY2F0aW9uLiIKICAgIGVsc2UKICAgICAgICBTY3JpcHRMb2cgIk1hbmFnZW1lbnQgQWN0aW9uOiBJbnN0YWxsYXRpb24gdm9uICR7ZGlzcGxheW5hbWV9IGVyZm9sZ3JlaWNoLiIKICAgICAgICAiJHtNQU5BR0VNRU5UX0FDVElPTn0iIC10aXRsZSAiSW5zdGFsbGF0aW9uc3RhdHVzIiAtbWVzc2FnZSAiSW5zdGFsbGF0aW9uIHZvbiAke2Rpc3BsYXluYW1lfSBlcmZvbGdyZWljaC4iICYKICAgIGZpCgogICAgU2NyaXB0TG9nICJGZXJ0aWcuIgp9CgpyZW1vdmVMYXVuY2hEYWVtb24oKSB7CiAgICBTY3JpcHRMb2cgIlJlbW92aW5nIExhdW5jaERhZW1vbiBcIiR7aWRlbnRpZmllcn0ubWFnaWNfaW5zdGFsbGVyXyR7YXBwbmFtZX0ucGxpc3RcIiIKICAgIGxhdW5jaGN0bCBsaXN0ICIke2lkZW50aWZpZXJ9Lm1hZ2ljX2luc3RhbGxlcl8ke2FwcG5hbWV9IiA+IC9kZXYvbnVsbCAyPiYxCiAgICBsYXVuY2hjdGxFcnJvcj0kPwogICAgaWYgW1sgIiR7bGF1bmNoY3RsRXJyb3J9IiAtZXEgMCBdXTsgdGhlbgogICAgICAgIHJtIC1mICIvTGlicmFyeS9MYXVuY2hEYWVtb25zLyR7aWRlbnRpZmllcn0ubWFnaWNfaW5zdGFsbGVyXyR7YXBwbmFtZX0ucGxpc3QiCiAgICAgICAgbGF1bmNoY3RsIHJlbW92ZSAiJHtpZGVudGlmaWVyfS5tYWdpY19pbnN0YWxsZXJfJHthcHBuYW1lfSIKICAgIGZpCn0KCmlmCiAgICBbWyAtbiAiJHthcHBWZXJzaW9uT2xkfSIgXV0gJiYKICAgIFtbIC1uICIke2FwcFZlcnNpb259IiBdXSAmJgogICAgJChjb21wYXJlVmVyc2lvbiAiJHthcHBWZXJzaW9uT2xkfSIgIiR7YXBwVmVyc2lvbn0iKTsKICAgIHRoZW4KICAgICAgICBTY3JpcHRMb2cgIlNhbWUgb3IgbmV3ZXIgVmVyc2lvbiBhbHJlYWR5IGluc3RhbGxlZCIKICAgICAgICBlY2hvICJTYW1lIG9yIG5ld2VyIFZlcnNpb24gYWxyZWFkeSBpbnN0YWxsZWQiCiAgICAgICAgcmVtb3ZlTGF1bmNoRGFlbW9uCiAgICAgICAgZXhpdCAxMApmaQoKZm9yIGFwcCBpbiAiJHthcHBhcnJheVtAXX0iOyBkbwogICAgd2F0Y2hlZFBJRCs9KCAkKHBncmVwIC1pICIke2FwcH0iIHwgZ3JlcCAtdiAiZ3JlcCIgfCBncmVwIC12ICJtYWdpY19pbnN0YWxsZXIiKSApCmRvbmUKZWNobyAid2F0Y2hlZFBJRDogJHt3YXRjaGVkUElEWypdfSIKaWYgW1sgIiR7d2F0Y2hlZFBJRFsqXS8jIC99IiA9PSAiIiBdXTsgdGhlbgogICAgU2NyaXB0TG9nICJTdGFydGluZyBpbnN0YWxsYXRpb24uIgogICAgaW5zdGFsbHBrZ3MKICAgIHJlbW92ZUxhdW5jaERhZW1vbgplbHNlCiAgICBpZiBbWyAiJHtkZWFkbGluZX0iIC1ndCAwIF1dOyB0aGVuCiAgICAgICAgIyBTY3JpcHRMb2cgImZvcmNlZCBpbnN0YWxsYXRpb24gd2lsbCBiZSBhY3RpdmF0ZWQuIgogICAgICAgIGVjaG8gImZvcmNlZCBpbnN0YWxsYXRpb24gd2lsbCBiZSBhY3RpdmF0ZWQuIgogICAgICAgIG5vcmVydW5iZWZvcmU9IiQodGFpbCAtbiAxICIke3NraXBwaW5nX2NvdW50ZXJ9IikiCiAgICAgICAgbG9nUmVwZWF0PSQoZ3JlcCAiJHtkaXNwbGF5bmFtZX0iICIke2xvZ0ZpbGV9IiAyPi9kZXYvbnVsbCB8IHRhaWwgLW4gMSB8IGdyZXAgLWMgIm5vcmVydW5iZWZvcmUiKQogICAgICAgIFtbIC16ICIke25vcmVydW5iZWZvcmV9IiBdXSAmJiBub3JlcnVuYmVmb3JlPTAKICAgICAgICBbWyAiJHtsb2dSZXBlYXR9IiAtZXEgMCBdXSAmJiBTY3JpcHRMb2cgIm5vcmVydW5iZWZvcmU6ICQoZGF0ZSAtciAke25vcmVydW5iZWZvcmV9ICsiJWQuJW0uJVkgJUg6JU06JVMiKSIKICAgICAgICAjIFNjcmlwdExvZyAibm93OiAgICAgICAgICAgJChkYXRlIC1yICR7bm93fSArIiVkLiVtLiVZICVIOiVNOiVTIikiCiAgICAgICAgZWNobyAibm93OiAgICAgICAgICAgJChkYXRlIC1yICR7bm93fSArIiVkLiVtLiVZICVIOiVNOiVTIikiCiAgICAgICAgaWYKICAgICAgICAgICAgW1sgIiR7bm9yZXJ1bmJlZm9yZX0iIC1sZSAiJHtub3d9IiBdXTsKICAgICAgICAgICAgdGhlbgogICAgICAgICAgICAgICAgc2tpcHBpbmdfY291bnRlcl9pbnQ9IiQod2MgLWwgIiR7c2tpcHBpbmdfY291bnRlcn0iIHwgYXdrICd7cHJpbnQgJDErMX0nKSIKICAgICAgICAgICAgICAgIFNjcmlwdExvZyAiI3dhaXRpbmdfZHVyYXRpb25bQF06ICR7I3dhaXRpbmdfZHVyYXRpb25bQF19IgogICAgICAgICAgICAgICAgU2NyaXB0TG9nICJza2lwcGluZ19jb3VudGVyX2ludDogJHNraXBwaW5nX2NvdW50ZXJfaW50IgoKICAgICAgICAgICAgICAgIGlmCiAgICAgICAgICAgICAgICAgICAgW1sgIiR7I3dhaXRpbmdfZHVyYXRpb25bQF19IiAtZ3QgIiR7c2tpcHBpbmdfY291bnRlcl9pbnR9IiBdXSAmJgogICAgICAgICAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICAgICAgICAgW1sgIiR7ZGVhZGxpbmV9IiAtZXEgMCBdXSB8fAogICAgICAgICAgICAgICAgICAgICAgICBbWyAiJHtkZWFkbGluZX0iIC1nZSAiJHtub3d9IiBdXQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PSIke3dhaXRpbmdfZHVyYXRpb25bJHNraXBwaW5nX2NvdW50ZXJfaW50LTFdfSIKICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsPSJ0cnVlIgogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PSIke3dhaXRpbmdfZHVyYXRpb25bJHsjd2FpdGluZ19kdXJhdGlvbltAXX0tMV19IiAjIGxhc3QgYXJyYXkgaXRlbQogICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWw9ImZhbHNlIgogICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgIFNjcmlwdExvZyAidGltZW91dDogJHRpbWVvdXQiCiAgICAgICAgICAgICAgICBTY3JpcHRMb2cgImNhbmNlbDogJGNhbmNlbCIKCiAgICAgICAgICAgICAgICBTY3JpcHRMb2cgIkFwcGxpY2F0aW9uIFwiJHthcHBuYW1lfVwiIGlzIHJ1bm5pbmcuLi4iCiAgICAgICAgICAgICAgICBTY3JpcHRMb2cgIkRpc3BsYXkgbWVzc2FnZSBmb3IgdXNlciBcIiR7Y3VycmVudHVzZXJ9XCIiCiAgICAgICAgICAgICAgICBkaXNwbGF5VXNlck1lc3NhZ2UgIkJpdHRlIGJlZW5kZW4gU2llICR7ZGlzcGxheW5hbWV9LCB1bSBTb2Z0d2FyZWFrdHVhbGlzaWVydW5nZW4gZHVyY2h6dWbDvGhyZW4uIiAiJHt0aW1lb3V0fSIgIiR7Y2FuY2VsfSIgPiAvZGV2L251bGwKICAgICAgICAgICAgICAgIGVycm9yY29kZT0iJD8iCiAgICAgICAgICAgICAgICBpZiBbWyAiJHtlcnJvcmNvZGV9IiAtZXEgMCBdXTsgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBhcHAgaW4gIiR7YXBwYXJyYXlbQF19IjsgZG8KICAgICAgICAgICAgICAgICAgICAgICAgU2NyaXB0TG9nICJRdWl0aW5nIFwiJGFwcFwiIHdpdGggQXBwbGVTY3JpcHQiCiAgICAgICAgICAgICAgICAgICAgICAgIG9zYXNjcmlwdCAtZSAidGVsbCBhcHBsaWNhdGlvbiBcIiR7YXBwfVwiIHRvIHF1aXQiCiAgICAgICAgICAgICAgICAgICAgZG9uZQogICAgICAgICAgICAgICAgICAgIC9iaW4vc2xlZXAgMgoKICAgICAgICAgICAgICAgICAgICBwcyAke3dhdGNoZWRQSURbKl19ID4vZGV2L251bGwgMj4mMQogICAgICAgICAgICAgICAgICAgIHBzZXJyb3I9JD8KICAgICAgICAgICAgICAgICAgICBpZiBbWyAiJHtwc2Vycm9yfSIgLWVxIDAgXV07IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgU2NyaXB0TG9nICJLaWxsaW5nIFwiJHtkaXNwbGF5bmFtZX1cIiAoJHt3YXRjaGVkUElEWypdfSkiCiAgICAgICAgICAgICAgICAgICAgICAgIGtpbGwgLTkgJHt3YXRjaGVkUElEWypdfSAyPi9kZXYvbnVsbAogICAgICAgICAgICAgICAgICAgIGZpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZWNobyAiJCgoIG5vdyArIHRpbWVvdXQgKSkiID4+ICIke3NraXBwaW5nX2NvdW50ZXJ9IgogICAgICAgICAgICAgICAgICAgIFNjcmlwdExvZyAiTWFudWFsIHNraXBwZWQuIgogICAgICAgICAgICAgICAgICAgIG5vdzI9IiQoZGF0ZSArJXMpIgogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQyPSQoKCB0aW1lb3V0IC0gKCBub3cyIC0gbm93ICkgKSkKICAgICAgICAgICAgICAgIGZpCiAgICAgICAgZWxzZQogICAgICAgICAgICBub3cyPSIkKGRhdGUgKyVzKSIKICAgICAgICAgICAgdGltZW91dDI9JCgoIG5vcmVydW5iZWZvcmUgLSBub3cyICkpCiAgICAgICAgICAgIGVjaG8gIk5leHQgcnVuOiAgICAgICQoZGF0ZSAtciAke25vcmVydW5iZWZvcmV9ICsiJWQuJW0uJVkgJUg6JU06JVMiKSIKICAgICAgICAgICAgIyBTY3JpcHRMb2cgIlNraXBwaW5nLiBOZXh0IHJ1biBhdCAkKGRhdGUgLXIgJHtub3JlcnVuYmVmb3JlfSArIiVkLiVtLiVZICVIOiVNOiVTIikiCiAgICAgICAgZmkKICAgIGVsc2UKICAgICAgICBsb2dnZWRJblVzZXI9JCgvYmluL2xzIC1sIC9kZXYvY29uc29sZSB8IC91c3IvYmluL2F3ayAneyBwcmludCAkMyB9JykKICAgICAgICBsb2dSZXBlYXQ9JChncmVwICIke2Rpc3BsYXluYW1lfSIgIiR7bG9nRmlsZX0iIDI+L2Rldi9udWxsIHwgdGFpbCAtbiAxIHwgZ3JlcCAtYyAiaXMgbG9nZ2VkIGluIGFuZCBhcHAgaXMgcnVubmluZyIpCiAgICAgICAgW1sgIiR7bG9nUmVwZWF0fSIgLWVxIDAgXV0gJiYgU2NyaXB0TG9nICJVc2VyIFwiJHtsb2dnZWRJblVzZXJ9XCIgaXMgbG9nZ2VkIGluIGFuZCBhcHAgaXMgcnVubmluZy4gRXhpdGluZy4iCiAgICBmaQoKZmkKCmV4aXQgMA==
" | base64 -D -o "${path}/magic_installer.sh"

appname="${4}"

chown -R root:admin "${path}/magic_installer.sh"
chmod +x "${path}/magic_installer.sh"

launchctl list ${identifier}.magic_installer_${appname} > /dev/null 2>&1
launchctlError=$?
if [[ "${launchctlError}" -eq 0 ]]; then
    rm -f "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
    launchctl remove ${identifier}.magic_installer_${appname}
fi

cat <<EOF > "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>Label</key>
	<string>${identifier}.magic_installer_${appname}</string>
	<key>RunAtLoad</key>
	<true/>
	<key>ProgramArguments</key>
	<array>
		<string>/bin/bash</string>
		<string>${path}/magic_installer.sh</string>
		<string>${1}</string>
		<string>${2}</string>
		<string>${3}</string>
		<string>${4}</string>
		<string>${5}</string>
		<string>${6}</string>
		<string>${7}</string>
		<string>${8}</string>
		<string>${9}</string>
		<string>${10}</string>
		<string>${11}</string>
	</array>
    <key>StartInterval</key>
    <integer>10</integer>
</dict>
</plist>
EOF

chown -R root:admin "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
chmod +x "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"

launchctl load -w "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
