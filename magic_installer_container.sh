#!/bin/bash
# Dennis Kruemmel, 2018

path="/Library/Application Support/Scripts"
[[ -d "${path}" ]] || mkdir -p "${path}"

identifier="com.mycompany"

echo "
IyEvYmluL2Jhc2gKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBEZW5uaXMgS3J1ZW1tZWwsIEJlY2h0bGUgR21iSCwgMjAxOAojCiMgd2l0aCBjb250ZW50IGZyb20KIyAgIGF1dG9fdXBkYXRlX21hZ2ljLnNoCiMgICBjaGVja2FwcHJ1bm5pbmdfd2l0aFRyaWdnZXIuc2gKIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojCiMgYmFzZTY0IC1pIH4vRG9jdW1lbnRzL2NvZGluZy9tYWMtc2NyaXB0cy9tYWdpY192OC5zaCB8IHBiY29weQojCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgTkFNRQojICAgbWFnaWNfdjguc2ggLS0gaGVscGVyIHNjcmlwdCBmb3IgbWFuYWdlZCBpbnN0YWxsYXRpb24gdGhyb3VnaCBqYW1mIHByby4KIyAKIyBTWU5PUFNJUwojICAgLi9tYWdpY192OC5zaCA8bW91bnRQb2ludD4gPGNvbXB1dGVyTmFtZT4gPHVzZXJOYW1lPiAiPHByb2Nlc3NOYW1lPls7PHByb2Nlc3NOYW1lPjsuLi5dIiAiWzxhcHBWZXJzaW9uPl0iICJbPGRpc3BsYXluYW1lPl0iICI8cGtnVG9JbnN0YWxsPls7PHBrZ1RvSW5zdGFsbD47Li4uXSIgWzxkZWFkbGluZT5dIFs8aWNvbj5dIFthcHBWZXJzaW9uT2xkXQojIAojIERFU0NSSVBUSU9OCiMgICBtb3VudFBvaW50CiMgICAgICAgdGFyZ2V0IGZvciBpbnN0YWxsZXIKIyAgICAgICBXaWxsIGJlIGF1dG9tYXRpY2FsbHkgc2V0IGZyb20gamFtZiBwcm8KIyAgICAgICBFeGFtcGxlOgojICAgICAgICAgIi8iCiMgCiMgICBjb21wdXRlck5hbWUKIyAgICAgICBob3N0bmFtZSBmcm9tIHRoZSBkZXN0aW5hdGlvbiBjb21wdXRlcgojICAgICAgIFdpbGwgYmUgYXV0b21hdGljYWxseSBzZXQgZnJvbSBqYW1mIHBybwojICAgICAgIEV4YW1wbGU6CiMgICAgICAgICAiTUJQMjAxNy0wMDEiCiMKIyAgIHVzZXJOYW1lCiMgICAgICAgbG9nZ2VkIGluIHVzZXIKIyAgICAgICBXaWxsIGJlIGF1dG9tYXRpY2FsbHkgc2V0IGZyb20gamFtZiBwcm8KIyAgICAgICBFeGFtcGxlOgojICAgICAgICAgIkNsYXJhLktvcm4iCiMgCiMgICBwcm9jZXNzTmFtZQojICAgICAgIHByb2Nlc3MgdG8gd2F0Y2guIFVzZSA7IGFzIGRlbGltaXRlciBmb3IgbXVsdGlwbGUgcHJvY2VzcyBuYW1lcwojICAgICAgIEV4YW1wbGU6CiMgICAgICAgICAiZmlyZWZveCIKIyAgICAgICAgICJmaXJlZm94O3NhZmFyaSIKIwojICAgYXBwVmVyc2lvbiAoT3B0aW9uYWwpCiMgICAgICAgVmVyc2lvbiBOdW1iZXIgZnJvbSB0aGUgYXBwIHdoaWNoIHdpbGwgYmUgaW5zdGFsbGVkLgojICAgICAgIEV4YW1wbGU6CiMgICAgICAgICAiNTIuNy4zIgojCiMgICBkaXNwbGF5bmFtZSAoT3B0aW9uYWwpCiMgICAgICAgTmFtZSB3aGljaCBiZSB1c2VkIGZvciBub3RpZmljYXRpb25zCiMgICAgICAgRXhhbXBsZToKIyAgICAgICAgICJGaXJlZm94IHdpdGggQ0NLIgojCiMgICBwa2dUb0luc3RhbGwKIyAgICAgICBQS0dzIGNhY2hlZCBpbiB0aGUgSkFNRiAiV2FpdGluZyBSb29tIi4gVXNlIDsgYXMgZGVsaW1pdGVyIGZvciBtdWx0aXBsZSBQYWNrYWdlcyB0byBpbnN0YWxsLgojICAgICAgIEV4YW1wbGU6CiMgICAgICAgICAiTXlQYWNrYWdlLTEuMC4wLnBrZyIKIyAgICAgICAgICJNeVBhY2thZ2UtMS4wLjAucGtnO015UGFja2FnZVVwZGF0ZS0xLjEuMC5wa2ciCiMgCiMgICBkZWFkbGluZSAoT3B0aW9uYWwpCiMgICAgICAgZGF0ZSBhcyB1bml4IHRpbWVzdGFtcCBvZiB0aGUgZm9yY2VkIGluc3RhbGwuIEFmdGVyIHRoaXMgZGF0ZSB0aGUgY291bnRkb3duIHdpbGwgYmUgaWdub3JlZC4KIyAgICAgICBJZiB0aGUgZGVhZGxpbmUgaXMgc2V0LCB0aGUgZm9yY2VkIGluc3RhbGwgd2lsbCBiZSBhY3RpdmF0ZWQuCiMgICAgICAgY2FsY3VsYXRlIHRoZSBkZWFkbGluZToKIyAgICAgICBkYXRlIC1qIC1mICIlZC4lbS4lWSAlSDolTTolUyIgIjMxLjEyLjIwMTggMDY6MDA6MDAiICslcwojICAgICAgIEV4YW1wbGU6CiMgICAgICAgICAiMTU0NjIzMjQwMCIKIwojICAgaWNvbiAoT3B0aW9uYWwpCiMgICAgICAgVGhpcyBpY29uIHdpbGwgYmUgdXNlZCBmb3IgdGhlIG1lc3NhZ2Vib3gKIyAgICAgICBFeGFtcGxlOgojICAgICAgICAgIi9BcHBsaWNhdGlvbnMvRmlyZWZveC5hcHAvQ29udGVudHMvUmVzb3VyY2VzL2ZpcmVmb3guaWNucyIKIwojICAgYXBwVmVyc2lvbk9sZCAoT3B0aW9uYWwpCiMgICAgICAgY29tbWFuZCB0byBkZXRlcm1pbmUgdGhlIHZlcnNpb24gZnJvbSB0aGUgb2xkIGluc3RhbGxlZCBhcHAuCiMgICAgICAgRXhhbXBsZToKIyAgICAgICAgICJkZWZhdWx0cyByZWFkIC9BcHBsaWNhdGlvbnMvRmlyZWZveC5hcHAvQ29udGVudHMvSW5mby5wbGlzdCBDRkJ1bmRsZVNob3J0VmVyc2lvblN0cmluZyIKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyB+L0RvY3VtZW50cy9jb2RpbmcvbWFjLXNjcmlwdHMvbWFnaWNfdjguc2ggLyAiJChob3N0bmFtZSkiICIkVVNFUiIgIlNhZmFyaSQ7RmlyZWZveCIgIjI5LjAiICJGbGFzaCAyOS4wIiAiZm9vLnBrZyIKIyB+L0RvY3VtZW50cy9jb2RpbmcvbWFjLXNjcmlwdHMvbWFnaWNfdjguc2ggLyAiJChob3N0bmFtZSkiICIkVVNFUiIgIlZMQyIgIjMuMC4zIiAiVkxDIE1lZGlhIFBsYXllciAzLjAuMyIgIlZpZGVvTEFOX1ZMQ01lZGlhUGxheWVyXzMuMC4zX0RFX1IxMzI1My5wa2ciCiMgfi9Eb2N1bWVudHMvY29kaW5nL21hYy1zY3JpcHRzL21hZ2ljX3Y4LnNoIC8gIiQoaG9zdG5hbWUpIiAiJFVTRVIiICJGaXJlZm94IiAiNjAuMC4yIiAiIiAiTW96aWxsYV9GaXJlZm94X0VTUl82MC4wLjJfREVfUjEzMjU1LnBrZztNb3ppbGxhX0ZpcmVmb3hfRVNSX0NDSzJfQ29uZmlnXzUuMC4zX0RFX1IxMzAyNS5wa2ciCiMgfi9Eb2N1bWVudHMvQ29kaW5nL21hYy1zY3JpcHRzL21hZ2ljX3Y4LnNoIC8gIiQoaG9zdG5hbWUpIiAiJFVTRVIiICJFbGVjdHJvbiIgIjEuMjYuMSIgIlZpc3VhbCBTdHVkaW8gQ29kZSIgIlZpZGVvTEFOX1ZMQ01lZGlhUGxheWVyXzMuMC4zX0RFX1IxMzI1My5wa2ciICIxNTQ2MjMyNDAwIiAiL0FwcGxpY2F0aW9ucy9WaXN1YWwgU3R1ZGlvIENvZGUuYXBwL0NvbnRlbnRzL1Jlc291cmNlcy9Db2RlLmljbnMiICIvQXBwbGljYXRpb25zL1Zpc3VhbCBTdHVkaW8gQ29kZS5hcHAvQ29udGVudHMvSW5mby5wbGlzdCIKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCmxvZ0ZpbGU9Ii92YXIvbG9nL21hZ2ljLmxvZyIKU2NyaXB0TG9nKCkgeyAjIFJlLWRpcmVjdCBsb2dnaW5nIHRvIHRoZSBsb2cgZmlsZSAuLi4KCWlmIFtbICEgLXogIiR7bG9nRmlsZX0iIF1dICYmIFtbICEgLWYgIiR7bG9nRmlsZX0iIF1dOyB0aGVuCgkJL3Vzci9iaW4vdG91Y2ggIiR7bG9nRmlsZX0iIHx8IGV4aXQgMQoJZWxpZiBbWyAteiAiJHtsb2dGaWxlfSIgXV07IHRoZW4KCQlsb2dGaWxlPSIvdmFyL2xvZy9zeXN0ZW0ubG9nIgoJCS91c3IvYmluL3RvdWNoICIke2xvZ0ZpbGV9IiB8fCBleGl0IDEKCWZpCgogICAgZXhlYyAzPiYxIDQ+JjIgICAgICAgICAgIyBTYXZlIHN0YW5kYXJkIG91dHB1dCBhbmQgc3RhbmRhcmQgZXJyb3IKICAgIGV4ZWMgMT4+IiR7bG9nRmlsZX0iICAgICMgUmVkaXJlY3Qgc3RhbmRhcmQgb3V0cHV0IHRvIGxvZ0ZpbGUKICAgIGV4ZWMgMj4+IiR7bG9nRmlsZX0iICAgICMgUmVkaXJlY3Qgc3RhbmRhcmQgZXJyb3IgdG8gbG9nRmlsZQoKICAgIFNjcmlwdExvZ05PVz0kKGRhdGUgKyVZLSVtLSVkXCAlSDolTTolUykKICAgIC9iaW4vZWNobyAiWyR7ZGlzcGxheW5hbWV9IHwgJHtTY3JpcHRMb2dOT1d9XSAgJHsxfSIgPj4gJHtsb2dGaWxlfQoJZXhlYyAxPiYzIDI+JjQKfQoKSkFNRj0iL3Vzci9sb2NhbC9iaW4vamFtZiIKSkFNRl9IRUxQRVI9Ii9MaWJyYXJ5L0FwcGxpY2F0aW9uIFN1cHBvcnQvSkFNRi9iaW4vamFtZkhlbHBlci5hcHAvQ29udGVudHMvTWFjT1MvamFtZkhlbHBlciIKSkFNRl9JQ09OUz0iL0xpYnJhcnkvQXBwbGljYXRpb24gU3VwcG9ydC9KQU1GL2Jpbi9qYW1mSGVscGVyLmFwcC9Db250ZW50cy9SZXNvdXJjZXMiCk1BTkFHRU1FTlRfQUNUSU9OPSIvTGlicmFyeS9BcHBsaWNhdGlvbiBTdXBwb3J0L0pBTUYvYmluL01hbmFnZW1lbnQgQWN0aW9uLmFwcC9Db250ZW50cy9NYWNPUy9NYW5hZ2VtZW50IEFjdGlvbiIKSkFNRl9DQUNIRT0iL0xpYnJhcnkvQXBwbGljYXRpb24gU3VwcG9ydC9KQU1GL1dhaXRpbmcgUm9vbSIKY3VycmVudHVzZXI9JChscyAtbCAvZGV2L2NvbnNvbGUgfCBjdXQgLWQgIiAiIC1mIDQpCnNraXBwaW5nX2NvdW50ZXJfZGlyPSIvTGlicmFyeS9BcHBsaWNhdGlvbiBTdXBwb3J0L0JhdWVyL2F1dG9fdXBkYXRlX21hZ2ljIgpbWyAtZCAiJHtza2lwcGluZ19jb3VudGVyX2Rpcn0iIF1dIHx8IG1rZGlyIC1wICIke3NraXBwaW5nX2NvdW50ZXJfZGlyfSIKd2FpdGluZ19kdXJhdGlvbj0oIDg2NDAwIDE0NDAwIDcyMDAgMTgwMCAzMDAgKSAjIDAgd2lsbCBkZWFjdGl2YXRlIHRoZSBjb3VudGRvd24Kbm93PSIkKGRhdGUgKyVzKSIKCmRpc3BsYXlVc2VyTWVzc2FnZSAoKSB7CglNWV9NRVNTQUdFPSIkezF9IgoJW1sgLXogIiR7Mn0iIF1dICYmIHRpbWVvdXQ9IjcyMDAiIHx8IHRpbWVvdXQ9IiR7Mn0iCglbWyAteiAiJHszfSIgXV0gJiYgY2FuY2VsPSJmYWxzZSIgfHwgY2FuY2VsPSIkezN9IgoJaWYKICAgICAgICBbWyAtbiAiJHtjdXN0b21pY29ufSIgXV0gJiYKICAgICAgICBbWyAtZiAiJHtjdXN0b21pY29ufSIgXV07CiAgICAgICAgdGhlbgoJCWljb249IiR7Y3VzdG9taWNvbn0iCgllbGlmCiAgICAgICAgW1sgLWYgIi9TeXN0ZW0vTGlicmFyeS9Db3JlU2VydmljZXMvU29mdHdhcmUgVXBkYXRlLmFwcC9Db250ZW50cy9SZXNvdXJjZXMvU29mdHdhcmVVcGRhdGUuaWNucyIgXV07CiAgICAgICAgdGhlbgoJCWljb249Ii9TeXN0ZW0vTGlicmFyeS9Db3JlU2VydmljZXMvU29mdHdhcmUgVXBkYXRlLmFwcC9Db250ZW50cy9SZXNvdXJjZXMvU29mdHdhcmVVcGRhdGUuaWNucyIKCWVsc2UKCQlpY29uPSIke0pBTUZfSUNPTlN9L01lc3NhZ2UucG5nIgoJZmkKCWlmIFtbICIke2NhbmNlbH0iID0gImZhbHNlIiBdXTsgdGhlbgoJCSIke0pBTUZfSEVMUEVSfSIgXAoJCQktd2luZG93VHlwZSB1dGlsaXR5IFwKCQkJLXRpdGxlICJTeXN0ZW11cGRhdGVzIHZlcmbDvGdiYXIiIFwKCQkJLWRlc2NyaXB0aW9uICIke01ZX01FU1NBR0V9IiBcCgkJCS1pY29uICIke2ljb259IiBcCgkJCS1idXR0b24xICJJbnN0YWxsaWVyZW4iIFwKCQkJLWRlZmF1bHRCdXR0b24gMSBcCgkJCS10aW1lb3V0ICR7dGltZW91dH0gXAoJCQktY291bnRkb3duCgllbHNlCgkJIiR7SkFNRl9IRUxQRVJ9IiBcCgkJCS13aW5kb3dUeXBlIHV0aWxpdHkgXAoJCQktdGl0bGUgIlN5c3RlbXVwZGF0ZXMgdmVyZsO8Z2JhciIgXAoJCQktZGVzY3JpcHRpb24gIiR7TVlfTUVTU0FHRX0iIFwKCQkJLWljb24gIiR7aWNvbn0iIFwKCQkJLWJ1dHRvbjEgIkluc3RhbGxpZXJlbiIgXAoJCQktYnV0dG9uMiAiU3DDpHRlciIgXAoJCQktZGVmYXVsdEJ1dHRvbiAxIFwKCQkJLWNhbmNlbEJ1dHRvbiAyIFwKCQkJLXRpbWVvdXQgJHt0aW1lb3V0fSBcCgkJCS1jb3VudGRvd24KCSBmaQoKfQoKY29tcGFyZVZlcnNpb24gKCl7CiAgICAvdXNyL2Jpbi9weXRob24gLSAiJDEiICIkMiIgPDwgRU9GCmltcG9ydCBzeXMKZnJvbSBkaXN0dXRpbHMudmVyc2lvbiBpbXBvcnQgTG9vc2VWZXJzaW9uIGFzIExWCnByaW50IExWKHN5cy5hcmd2WzFdKSA+PSBMVihzeXMuYXJndlsyXSkKRU9GCn0KCmlmIFsgLW4gIiR7NH0iIF07IHRoZW4KCWFwcG5hbWU9IiR7NH0iCmVsc2UKCWVjaG8gIkVycm9yOiBQcm9jZXNzbmFtZSBub3Qgc2V0IChoaW50OiBhcmd1bWVudCAjNCkiIDE+JjIKICAgIGVjaG8gIlByb2Nlc3NuYW1lICh1c2UgOyBhcyBkZWxpbWl0ZXIpIgoJZXhpdCA0CmZpCgppZiBbIC1uICIkezV9IiBdOyB0aGVuCglhcHBWZXJzaW9uPSIkezV9IgplbHNlCglhcHBWZXJzaW9uPSIiCmZpCgppZiBbIC1uICIkezZ9IiBdOyB0aGVuCglkaXNwbGF5bmFtZT0iJHs2fSIKZWxzZQoJZWNobyAiSW5mbzogRGlzcGxheW5hbWUgbm90IHNldCAoaGludDogYXJndW1lbnQgIzYpLiBVc2luZyBBcHBuYW1lIFwiJHthcHBuYW1lfVwiIGFuZCBhcHBWZXJzaW9uIFwiJHthcHBWZXJzaW9ufVwiIGFzIGRpc3BsYXluYW1lLiIKCWlmIFtbIC1uICIke2FwcFZlcnNpb259IiBdXTsgdGhlbgogICAgICAgIGRpc3BsYXluYW1lPSIke2FwcG5hbWV9ICR7YXBwVmVyc2lvbn0iCiAgICBlbHNlCgkgICAgZGlzcGxheW5hbWU9IiR7YXBwbmFtZX0iCiAgICBmaQogICAgZWNobyAiRGlzcGxheW5hbWU6IFwiJHtkaXNwbGF5bmFtZX1cIiIKZmkKCmlmIFsgLW4gIiR7N30iIF07IHRoZW4KCXBrZ3M9IiR7N30iCmVsc2UKCWVjaG8gIkVycm9yOiBQS0dzIHRvIGluc3RhbGwgbm90IHNldCAoaGludDogYXJndW1lbnQgIzcpIiAxPiYyCiAgICBlY2hvICJQS0dzIHRvIGluc3RhbGwgKHVzZSA7IGFzIGRlbGltaXRlcikiCglleGl0IDcKZmkKCnNraXBwaW5nX2NvdW50ZXI9IiR7c2tpcHBpbmdfY291bnRlcl9kaXJ9LyR7ZGlzcGxheW5hbWV9Igp0b3VjaCAiJHtza2lwcGluZ19jb3VudGVyfSIKCmlmIFsgLW4gIiR7OH0iIF07IHRoZW4KCWRlYWRsaW5lPSIkezh9IgplbHNlCglkZWFkbGluZT0iMCIKZmkKW1sgIiR7ZGVhZGxpbmV9IiA9PSAiMCIgXV0gJiYgZWNobyAiZGVhZGxpbmU6IG5vdCBzZXQiIHx8IGVjaG8gImRlYWRsaW5lOiAkKGRhdGUgLXIgJHtkZWFkbGluZX0gKyIlZC4lbS4lWSAlSDolTTolUyIpIgoKaWYgWyAtbiAiJHs5fSIgXTsgdGhlbgoJY3VzdG9taWNvbj0iJHs5fSIKZmkKCmlmIFsgLW4gIiR7MTB9IiBdOyB0aGVuCiAgICBpZiBbWyAteiAiJHsxMX0iIF1dOyB0aGVuCiAgICAgICAgcGxpc3RLZXk9IkNGQnVuZGxlU2hvcnRWZXJzaW9uU3RyaW5nIgogICAgZWxzZQogICAgICAgIHBsaXN0S2V5PSIkezExfSIKICAgIGZpCglhcHBWZXJzaW9uT2xkPSIkKGRlZmF1bHRzIHJlYWQgIiR7MTB9IiAiJHtwbGlzdEtleX0iIDI+L2Rldi9udWxsKSIKZmkKCmRlY2xhcmUgLWEgYXBwYXJyYXkKZGVjbGFyZSAtYSBwa2dhcnJheQphcHBsaW5lcz0kKGVjaG8gIiR7YXBwbmFtZX0ifHRyICI7IiAiXG4iKQp3aGlsZSByZWFkIC1yIGFwcDsgZG8KCWFwcGFycmF5Kz0oIiRhcHAiKQpkb25lIDw8PCIke2FwcGxpbmVzfSIKCnBrZ2xpbmVzPSQoZWNobyAiJHtwa2dzfSJ8dHIgIjsiICJcbiIpCndoaWxlIHJlYWQgLXIgcGtnOyBkbwoJcGtnYXJyYXkrPSgiJHBrZyIpCmRvbmUgPDw8IiR7cGtnbGluZXN9IgoKIyBTY3JpcHRMb2cgIktpbGxpbmcgb2xkIHByb2Nlc3Nlcy4iCiMgU2NyaXB0TG9nICJzZWxmcGlkOiAkJCIKb3RoZXJwaWRzPSQoIHBzIGF1eCB8IGdyZXAgIlttXWFnaWMiIHwgZ3JlcCAiJChlY2hvICR7YXBwbmFtZX18c2VkICdzLzsvXFx8L2cnKSIgfCBhd2sgJ3twcmludCAkMn0nIHwgZ3JlcCAtdiAiJCQiICkKIyBTY3JpcHRMb2cgIm90aGVycGlkczogJG90aGVycGlkcyIKd2hpbGUgcmVhZCAtciBvcGlkOyBkbwogICAga2lsbCAkb3BpZCAyPi9kZXYvbnVsbApkb25lIDw8PCIke290aGVycGlkc30iCgppbnN0YWxscGtncygpIHsKICAgIFNjcmlwdExvZyAiUHJlcGFyaW5nIEluc3RhbGxhdGlvbiBvZiAke2Rpc3BsYXluYW1lfSIKCiAgICBmb3IgcGtnIGluICIke3BrZ2FycmF5W0BdfSIKICAgIGRvCiAgICAgICAgaWYgWyAhIC1mICIke0pBTUZfQ0FDSEV9LyR7cGtnfSIgXTsgdGhlbgogICAgICAgICAgICBTY3JpcHRMb2cgIkZpbGUgXCIke0pBTUZfQ0FDSEV9LyR7cGtnfVwiIGRvZXNuJ3QgZXhpc3QuIgogICAgICAgICAgICByZW1vdmVMYXVuY2hEYWVtb24KICAgICAgICAgICAgZXhpdCAxCiAgICAgICAgZmkKICAgIGRvbmUKCiAgICBpZiBbWyAiJHtsb2dnZWRJblVzZXJ9IiA9ICJyb290IiBdXTsgdGhlbgogICAgICAgIGVjaG8gIk5vIFVzZXIgbG9nZ2VkIGluLiBTa2lwcGluZyBub3RpZmljYXRpb24uIgogICAgZWxzZQogICAgICAgIFNjcmlwdExvZyAiTWFuYWdlbWVudCBBY3Rpb246IFN0YXJ0ZSBJbnN0YWxsYXRpb24gdm9uICR7ZGlzcGxheW5hbWV9LiIKICAgICAgICAiJHtNQU5BR0VNRU5UX0FDVElPTn0iIC10aXRsZSAiSW5zdGFsbGF0aW9uc3RhdHVzIiAtbWVzc2FnZSAiU3RhcnRlIEluc3RhbGxhdGlvbiB2b24gJHtkaXNwbGF5bmFtZX0uIiAmCiAgICBmaQoKICAgIGZvciBwa2cgaW4gIiR7cGtnYXJyYXlbQF19IgogICAgZG8KICAgICAgICBTY3JpcHRMb2cgIkluc3RhbGxpbmcgXCIke0pBTUZfQ0FDSEV9LyR7cGtnfVwiIgogICAgICAgICMgaW5zdGFsbGVyIC1wa2cgIiR7SkFNRl9DQUNIRX0vJHtwa2d9IiAtdGFyZ2V0IC8gIy1kdW1wbG9nCiAgICAgICAgIyBTY3JpcHRMb2cgImphbWYgaW5zdGFsbCAtcGFja2FnZSAke3BrZ30gLXBhdGggJHtKQU1GX0NBQ0hFfSAtdGFyZ2V0IC8iICMtc2hvd1Byb2dyZXNzCiAgICAgICAgIiR7SkFNRn0iIGluc3RhbGwgLXBhY2thZ2UgIiR7cGtnfSIgLXBhdGggIiR7SkFNRl9DQUNIRX0iIC10YXJnZXQgLyA+PiAvdmFyL2xvZy9tYWdpYy5sb2cgMj4mMQogICAgICAgIGV4aXRjb2RlPSQ/CiAgICAgICAgU2NyaXB0TG9nICJJbnN0YWxsZXIgZG9uZSB3aXRoIGV4aXRjb2RlICRleGl0Y29kZSIKICAgICAgICBbWyAiJHsjcGtnYXJyYXlbQF19IiAtZ3QgMSBdXSAmJiAvYmluL3NsZWVwIDIKICAgIGRvbmUKICAgIGVjaG8gLW4gIiIgPiAiJHtza2lwcGluZ19jb3VudGVyfSIKCiAgICBpZiBbWyAiJHtsb2dnZWRJblVzZXJ9IiA9ICJyb290IiBdXTsgdGhlbgogICAgICAgIGVjaG8gIk5vIFVzZXIgbG9nZ2VkIGluLiBTa2lwcGluZyBub3RpZmljYXRpb24uIgogICAgZWxzZQogICAgICAgIFNjcmlwdExvZyAiTWFuYWdlbWVudCBBY3Rpb246IEluc3RhbGxhdGlvbiB2b24gJHtkaXNwbGF5bmFtZX0gZXJmb2xncmVpY2guIgogICAgICAgICIke01BTkFHRU1FTlRfQUNUSU9OfSIgLXRpdGxlICJJbnN0YWxsYXRpb25zdGF0dXMiIC1tZXNzYWdlICJJbnN0YWxsYXRpb24gdm9uICR7ZGlzcGxheW5hbWV9IGVyZm9sZ3JlaWNoLiIgJgogICAgZmkKCiAgICBTY3JpcHRMb2cgIkZlcnRpZy4iCn0KCnJlbW92ZUxhdW5jaERhZW1vbigpIHsKICAgIFNjcmlwdExvZyAiUmVtb3ZpbmcgTGF1bmNoRGFlbW9uIFwiZ3JvdXAuYmF1ZXJtZWRpYS5tYWdpY18ke2FwcG5hbWV9LnBsaXN0XCIiCiAgICBsYXVuY2hjdGwgbGlzdCAiZ3JvdXAuYmF1ZXJtZWRpYS5tYWdpY18ke2FwcG5hbWV9IiA+IC9kZXYvbnVsbCAyPiYxCiAgICBsYXVuY2hjdGxFcnJvcj0kPwogICAgaWYgW1sgIiR7bGF1bmNoY3RsRXJyb3J9IiAtZXEgMCBdXTsgdGhlbgogICAgICAgIHJtIC1mICIvTGlicmFyeS9MYXVuY2hEYWVtb25zL2dyb3VwLmJhdWVybWVkaWEubWFnaWNfJHthcHBuYW1lfS5wbGlzdCIKICAgICAgICBsYXVuY2hjdGwgcmVtb3ZlICJncm91cC5iYXVlcm1lZGlhLm1hZ2ljXyR7YXBwbmFtZX0iCiAgICBmaQp9CgppZgogICAgW1sgLW4gIiR7YXBwVmVyc2lvbk9sZH0iIF1dICYmCiAgICBbWyAtbiAiJHthcHBWZXJzaW9ufSIgXV0gJiYKICAgICQoY29tcGFyZVZlcnNpb24gIiR7YXBwVmVyc2lvbk9sZH0iICIke2FwcFZlcnNpb259Iik7CiAgICB0aGVuCiAgICAgICAgU2NyaXB0TG9nICJTYW1lIG9yIG5ld2VyIFZlcnNpb24gYWxyZWFkeSBpbnN0YWxsZWQiCiAgICAgICAgZWNobyAiU2FtZSBvciBuZXdlciBWZXJzaW9uIGFscmVhZHkgaW5zdGFsbGVkIgogICAgICAgIHJlbW92ZUxhdW5jaERhZW1vbgogICAgICAgIGV4aXQgMTAKZmkKCmZvciBhcHAgaW4gIiR7YXBwYXJyYXlbQF19IjsgZG8KICAgIHdhdGNoZWRQSUQrPSggJChwZ3JlcCAtaSAiJHthcHB9IiB8IGdyZXAgLXYgImdyZXAiIHwgZ3JlcCAtdiAibWFnaWNfIikgKQpkb25lCiMgd2F0Y2hlZFBJRD0kKHBzIGF1eCB8IGdyZXAgLWkgIiQoZWNobyAiJHthcHBuYW1lfSIgfCBzZWQgInMvOy9cXFxcfC9nIikiIHwgZ3JlcCAtdiAiZ3JlcCIgfCBncmVwIC12ICJtYWdpY18iIHwgYXdrICd7cHJpbnQgJDJ9JykKZWNobyAid2F0Y2hlZFBJRDogJHt3YXRjaGVkUElEWypdfSIKaWYgW1sgIiR7d2F0Y2hlZFBJRFsqXS8jIC99IiA9PSAiIiBdXTsgdGhlbgogICAgU2NyaXB0TG9nICJTdGFydGluZyBpbnN0YWxsYXRpb24uIgogICAgaW5zdGFsbHBrZ3MKICAgIHJlbW92ZUxhdW5jaERhZW1vbgplbHNlCiAgICBpZiBbWyAiJHtkZWFkbGluZX0iIC1ndCAwIF1dOyB0aGVuCiAgICAgICAgIyBTY3JpcHRMb2cgImZvcmNlZCBpbnN0YWxsYXRpb24gd2lsbCBiZSBhY3RpdmF0ZWQuIgogICAgICAgIGVjaG8gImZvcmNlZCBpbnN0YWxsYXRpb24gd2lsbCBiZSBhY3RpdmF0ZWQuIgogICAgICAgIG5vcmVydW5iZWZvcmU9IiQodGFpbCAtbiAxICIke3NraXBwaW5nX2NvdW50ZXJ9IikiCiAgICAgICAgbG9nUmVwZWF0PSQoZ3JlcCAiJHtkaXNwbGF5bmFtZX0iICIke2xvZ0ZpbGV9IiB8IHRhaWwgLW4gMSB8IGdyZXAgLWMgIm5vcmVydW5iZWZvcmUiKQogICAgICAgIFtbIC16ICIke25vcmVydW5iZWZvcmV9IiBdXSAmJiBub3JlcnVuYmVmb3JlPTAKICAgICAgICBbWyAiJHtsb2dSZXBlYXR9IiAtZXEgMCBdXSAmJiBTY3JpcHRMb2cgIm5vcmVydW5iZWZvcmU6ICQoZGF0ZSAtciAke25vcmVydW5iZWZvcmV9ICsiJWQuJW0uJVkgJUg6JU06JVMiKSIKICAgICAgICAjIFNjcmlwdExvZyAibm93OiAgICAgICAgICAgJChkYXRlIC1yICR7bm93fSArIiVkLiVtLiVZICVIOiVNOiVTIikiCiAgICAgICAgZWNobyAibm93OiAgICAgICAgICAgJChkYXRlIC1yICR7bm93fSArIiVkLiVtLiVZICVIOiVNOiVTIikiCiAgICAgICAgaWYKICAgICAgICAgICAgW1sgIiR7bm9yZXJ1bmJlZm9yZX0iIC1sZSAiJHtub3d9IiBdXTsKICAgICAgICAgICAgdGhlbgogICAgICAgICAgICAgICAgc2tpcHBpbmdfY291bnRlcl9pbnQ9IiQod2MgLWwgIiR7c2tpcHBpbmdfY291bnRlcn0iIHwgYXdrICd7cHJpbnQgJDErMX0nKSIKICAgICAgICAgICAgICAgIFNjcmlwdExvZyAiI3dhaXRpbmdfZHVyYXRpb25bQF06ICR7I3dhaXRpbmdfZHVyYXRpb25bQF19IgogICAgICAgICAgICAgICAgU2NyaXB0TG9nICJza2lwcGluZ19jb3VudGVyX2ludDogJHNraXBwaW5nX2NvdW50ZXJfaW50IgoKICAgICAgICAgICAgICAgIGlmCiAgICAgICAgICAgICAgICAgICAgW1sgIiR7I3dhaXRpbmdfZHVyYXRpb25bQF19IiAtZ3QgIiR7c2tpcHBpbmdfY291bnRlcl9pbnR9IiBdXSAmJgogICAgICAgICAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICAgICAgICAgW1sgIiR7ZGVhZGxpbmV9IiAtZXEgMCBdXSB8fAogICAgICAgICAgICAgICAgICAgICAgICBbWyAiJHtkZWFkbGluZX0iIC1nZSAiJHtub3d9IiBdXQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PSIke3dhaXRpbmdfZHVyYXRpb25bJHNraXBwaW5nX2NvdW50ZXJfaW50LTFdfSIKICAgICAgICAgICAgICAgICAgICAgICAgY2FuY2VsPSJ0cnVlIgogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PSIke3dhaXRpbmdfZHVyYXRpb25bJHsjd2FpdGluZ19kdXJhdGlvbltAXX0tMV19IiAjIGxhc3QgYXJyYXkgaXRlbQogICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWw9ImZhbHNlIgogICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgIFNjcmlwdExvZyAidGltZW91dDogJHRpbWVvdXQiCiAgICAgICAgICAgICAgICBTY3JpcHRMb2cgImNhbmNlbDogJGNhbmNlbCIKCiAgICAgICAgICAgICAgICBTY3JpcHRMb2cgIkFwcGxpY2F0aW9uIFwiJHthcHBuYW1lfVwiIGlzIHJ1bm5pbmcuLi4iCiAgICAgICAgICAgICAgICBTY3JpcHRMb2cgIkRpc3BsYXkgbWVzc2FnZSBmb3IgdXNlciBcIiR7Y3VycmVudHVzZXJ9XCIiCiAgICAgICAgICAgICAgICBkaXNwbGF5VXNlck1lc3NhZ2UgIkJpdHRlIGJlZW5kZW4gU2llICR7ZGlzcGxheW5hbWV9LCB1bSBTb2Z0d2FyZWFrdHVhbGlzaWVydW5nZW4gZHVyY2h6dWbDvGhyZW4uIiAiJHt0aW1lb3V0fSIgIiR7Y2FuY2VsfSIgPiAvZGV2L251bGwKICAgICAgICAgICAgICAgIGVycm9yY29kZT0iJD8iCiAgICAgICAgICAgICAgICBpZiBbWyAiJHtlcnJvcmNvZGV9IiAtZXEgMCBdXTsgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBhcHAgaW4gIiR7YXBwYXJyYXlbQF19IjsgZG8KICAgICAgICAgICAgICAgICAgICAgICAgU2NyaXB0TG9nICJRdWl0aW5nIFwiJGFwcFwiIHdpdGggQXBwbGVTY3JpcHQiCiAgICAgICAgICAgICAgICAgICAgICAgIG9zYXNjcmlwdCAtZSAidGVsbCBhcHBsaWNhdGlvbiBcIiR7YXBwfVwiIHRvIHF1aXQiCiAgICAgICAgICAgICAgICAgICAgZG9uZQogICAgICAgICAgICAgICAgICAgIC9iaW4vc2xlZXAgMgoKICAgICAgICAgICAgICAgICAgICBwcyAke3dhdGNoZWRQSURbKl19ID4vZGV2L251bGwgMj4mMQogICAgICAgICAgICAgICAgICAgIHBzZXJyb3I9JD8KICAgICAgICAgICAgICAgICAgICBpZiBbWyAiJHtwc2Vycm9yfSIgLWVxIDAgXV07IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgU2NyaXB0TG9nICJLaWxsaW5nIFwiJHtkaXNwbGF5bmFtZX1cIiAoJHt3YXRjaGVkUElEWypdfSkiCiAgICAgICAgICAgICAgICAgICAgICAgIGtpbGwgLTkgJHt3YXRjaGVkUElEWypdfSAyPi9kZXYvbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAjIC9iaW4vc2xlZXAgNSAmJiBwa2lsbCAiTWljcm9zb2Z0IEVycm9yIFJlcG9ydGluZyIgIyBuaWNodCBtZWhyIG5vdHdlbmRpZywgZGEgImtpbGwgLTkiCiAgICAgICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBlY2hvICIkKCggbm93ICsgdGltZW91dCApKSIgPj4gIiR7c2tpcHBpbmdfY291bnRlcn0iCiAgICAgICAgICAgICAgICAgICAgU2NyaXB0TG9nICJNYW51YWwgc2tpcHBlZC4iCiAgICAgICAgICAgICAgICAgICAgbm93Mj0iJChkYXRlICslcykiCiAgICAgICAgICAgICAgICAgICAgdGltZW91dDI9JCgoIHRpbWVvdXQgLSAoIG5vdzIgLSBub3cgKSApKQogICAgICAgICAgICAgICAgICAgICMgZWNobyAiV2FpdGluZyAke3RpbWVvdXQyfXMuIgogICAgICAgICAgICAgICAgICAgICMgL2Jpbi9zbGVlcCAke3RpbWVvdXQyfQogICAgICAgICAgICAgICAgICAgICMgL2Jpbi9zbGVlcCAxCiAgICAgICAgICAgICAgICBmaQogICAgICAgIGVsc2UKICAgICAgICAgICAgbm93Mj0iJChkYXRlICslcykiCiAgICAgICAgICAgIHRpbWVvdXQyPSQoKCBub3JlcnVuYmVmb3JlIC0gbm93MiApKQogICAgICAgICAgICBTY3JpcHRMb2cgIlNraXBwaW5nLiBOZXh0IHJ1biBhdCAkKGRhdGUgLXIgJHtub3JlcnVuYmVmb3JlfSArIiVkLiVtLiVZICVIOiVNOiVTIikiCiAgICAgICAgICAgICMgZWNobyAiU2tpcHBpbmcuIE5leHQgcnVuIGF0ICQoZGF0ZSAtciAke25vcmVydW5iZWZvcmV9ICsiJWQuJW0uJVkgJUg6JU06JVMiKSIKICAgICAgICAgICAgIyBlY2hvICJXYWl0aW5nICR7dGltZW91dDJ9cy4iCiAgICAgICAgICAgICMgL2Jpbi9zbGVlcCAke3RpbWVvdXQyfQogICAgICAgICAgICAjIC9iaW4vc2xlZXAgMQogICAgICAgIGZpCiAgICBlbHNlCiAgICAgICAgbG9nZ2VkSW5Vc2VyPSQoL2Jpbi9scyAtbCAvZGV2L2NvbnNvbGUgfCAvdXNyL2Jpbi9hd2sgJ3sgcHJpbnQgJDMgfScpCiAgICAgICAgbG9nUmVwZWF0PSQoZ3JlcCAiJHtkaXNwbGF5bmFtZX0iICIke2xvZ0ZpbGV9IiB8IHRhaWwgLW4gMSB8IGdyZXAgLWMgImlzIGxvZ2dlZCBpbiBhbmQgYXBwIGlzIHJ1bm5pbmciKQogICAgICAgIFtbICIke2xvZ1JlcGVhdH0iIC1lcSAwIF1dICYmIFNjcmlwdExvZyAiVXNlciBcIiR7bG9nZ2VkSW5Vc2VyfVwiIGlzIGxvZ2dlZCBpbiBhbmQgYXBwIGlzIHJ1bm5pbmcuIEV4aXRpbmcuIgogICAgZmkKCmZpCgpleGl0IDA=
" | base64 -D -o "${path}/magic_installer.sh"

appname="${4}"

chown -R root:admin "${path}/magic_installer.sh"
chmod +x "${path}/magic_installer.sh"

launchctl list ${identifier}.magic_installer_${appname} > /dev/null 2>&1
launchctlError=$?
if [[ "${launchctlError}" -eq 0 ]]; then
    rm -f "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
    launchctl remove ${identifier}.magic_installer_${appname}
fi

cat <<EOF > "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>Label</key>
	<string>${identifier}.magic_installer_${appname}</string>
	<key>RunAtLoad</key>
	<true/>
	<key>ProgramArguments</key>
	<array>
		<string>/bin/bash</string>
		<string>${path}/magic_installer.sh</string>
		<string>${1}</string>
		<string>${2}</string>
		<string>${3}</string>
		<string>${4}</string>
		<string>${5}</string>
		<string>${6}</string>
		<string>${7}</string>
		<string>${8}</string>
		<string>${9}</string>
		<string>${10}</string>
		<string>${11}</string>
	</array>
    <key>StartInterval</key>
    <integer>10</integer>
</dict>
</plist>
EOF

chown -R root:admin "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
chmod +x "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"

launchctl load -w "/Library/LaunchDaemons/${identifier}.magic_installer_${appname}.plist"
